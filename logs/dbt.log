[0m10:15:22.802593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c74a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c76090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090e1be0>]}


============================== 10:15:22.804658 | 5241a95e-1531-4ca1-8679-36de73e98be3 ==============================
[0m10:15:22.804658 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:15:22.804976 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:15:22.809232 [info ] [MainThread]: dbt version: 1.8.5
[0m10:15:22.809413 [info ] [MainThread]: python version: 3.12.5
[0m10:15:22.809627 [info ] [MainThread]: python path: /Users/paulfoote/Documents/dbt-env/bin/python
[0m10:15:22.809845 [info ] [MainThread]: os info: macOS-14.5-arm64-arm-64bit
[0m10:15:22.859695 [info ] [MainThread]: Using profiles dir at /Users/paulfoote/.dbt
[0m10:15:22.859965 [info ] [MainThread]: Using profiles.yml file at /Users/paulfoote/.dbt/profiles.yml
[0m10:15:22.860101 [info ] [MainThread]: Using dbt_project.yml file at /Users/paulfoote/Documents/dbt/brightwheel/dbt_project.yml
[0m10:15:22.860364 [info ] [MainThread]: adapter type: postgres
[0m10:15:22.860489 [info ] [MainThread]: adapter version: 1.8.2
[0m10:15:22.897968 [info ] [MainThread]: Configuration:
[0m10:15:22.898240 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:15:22.898380 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:15:22.898501 [info ] [MainThread]: Required dependencies:
[0m10:15:22.898786 [debug] [MainThread]: Executing "git --help"
[0m10:15:22.911715 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:15:22.912246 [debug] [MainThread]: STDERR: "b''"
[0m10:15:22.912436 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:15:22.912588 [info ] [MainThread]: Connection:
[0m10:15:22.912738 [info ] [MainThread]:   host: 127.0.0.1
[0m10:15:22.912849 [info ] [MainThread]:   port: 5432
[0m10:15:22.912956 [info ] [MainThread]:   user: paulfoote
[0m10:15:22.913062 [info ] [MainThread]:   database: brightwheel
[0m10:15:22.913167 [info ] [MainThread]:   schema: brightwheel_exam
[0m10:15:22.913274 [info ] [MainThread]:   connect_timeout: 10
[0m10:15:22.913379 [info ] [MainThread]:   role: None
[0m10:15:22.913484 [info ] [MainThread]:   search_path: None
[0m10:15:22.913584 [info ] [MainThread]:   keepalives_idle: 0
[0m10:15:22.913684 [info ] [MainThread]:   sslmode: None
[0m10:15:22.913784 [info ] [MainThread]:   sslcert: None
[0m10:15:22.913886 [info ] [MainThread]:   sslkey: None
[0m10:15:22.913985 [info ] [MainThread]:   sslrootcert: None
[0m10:15:22.914087 [info ] [MainThread]:   application_name: dbt
[0m10:15:22.914189 [info ] [MainThread]:   retries: 1
[0m10:15:22.914519 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m10:15:22.917775 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m10:15:22.939415 [debug] [MainThread]: Using postgres connection "debug"
[0m10:15:22.939650 [debug] [MainThread]: On debug: select 1 as id
[0m10:15:22.939782 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:15:22.950931 [debug] [MainThread]: SQL status: SELECT 1 in 0.011 seconds
[0m10:15:22.951642 [debug] [MainThread]: On debug: Close
[0m10:15:22.951859 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:15:22.952029 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:15:22.952926 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.17835833, "process_user_time": 0.664111, "process_kernel_time": 0.085374, "process_mem_max_rss": "110002176", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:15:22.953264 [debug] [MainThread]: Command `dbt debug` succeeded at 10:15:22.953207 after 0.18 seconds
[0m10:15:22.953428 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:15:22.953625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109097170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c74a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c4170>]}
[0m10:15:22.953827 [debug] [MainThread]: Flushing usage events
[0m13:26:57.538200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d42f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075de360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075de0c0>]}


============================== 13:26:57.540473 | 0606236f-1943-4957-9ad6-818ca46c056c ==============================
[0m13:26:57.540473 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:26:57.540773 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run -m source1', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:26:57.647025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de24e0>]}
[0m13:26:57.669765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d6bd10>]}
[0m13:26:57.670338 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:26:57.680213 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:26:57.680880 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:26:57.681099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e4ec0>]}
[0m13:26:58.208679 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
- models.brightwheel.2_mart
[0m13:26:58.213740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f324e0>]}
[0m13:26:58.265307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104f2ea0>]}
[0m13:26:58.265612 [info ] [MainThread]: Found 6 models, 4 data tests, 4 sources, 417 macros
[0m13:26:58.265778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102df3b0>]}
[0m13:26:58.266580 [info ] [MainThread]: 
[0m13:26:58.266875 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:26:58.267348 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:26:58.295525 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:26:58.295759 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:26:58.295898 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:26:58.309256 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.013 seconds
[0m13:26:58.310022 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:26:58.312093 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:26:58.315052 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:26:58.315213 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:26:58.315336 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:26:58.319919 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m13:26:58.320079 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:26:58.320222 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:26:58.327622 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m13:26:58.328177 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:26:58.328478 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:26:58.330613 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.330779 [debug] [MainThread]: On master: BEGIN
[0m13:26:58.330904 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:26:58.336611 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:26:58.336751 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.336936 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:26:58.345503 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m13:26:58.346034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105bbbc0>]}
[0m13:26:58.346261 [debug] [MainThread]: On master: ROLLBACK
[0m13:26:58.346525 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.346666 [debug] [MainThread]: On master: BEGIN
[0m13:26:58.347077 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:26:58.347210 [debug] [MainThread]: On master: COMMIT
[0m13:26:58.347329 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.347447 [debug] [MainThread]: On master: COMMIT
[0m13:26:58.347668 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:26:58.347794 [debug] [MainThread]: On master: Close
[0m13:26:58.347984 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:26:58.348131 [info ] [MainThread]: 
[0m13:26:58.349803 [debug] [Thread-1 (]: Began running node model.brightwheel.source1
[0m13:26:58.350072 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.source1 ........................... [RUN]
[0m13:26:58.350281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.source1)
[0m13:26:58.350446 [debug] [Thread-1 (]: Began compiling node model.brightwheel.source1
[0m13:26:58.354393 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.source1"
[0m13:26:58.355037 [debug] [Thread-1 (]: Began executing node model.brightwheel.source1
[0m13:26:58.372681 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.source1"
[0m13:26:58.373425 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:26:58.373592 [debug] [Thread-1 (]: On model.brightwheel.source1: BEGIN
[0m13:26:58.373739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:26:58.377583 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m13:26:58.377776 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:26:58.377955 [debug] [Thread-1 (]: On model.brightwheel.source1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source1"} */

  create view "brightwheel"."brightwheel_exam"."source1__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/source1

with source as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

clean as (

    select
        name,
        credential_type,
        credential_number,
        status,
        expiration_date,
        disciplinary_action,
        address,
        state,
        county,
        phone,
        first_issue_date,
        primary_contact_name,
        primary_contact_role

    from source

)

select * from clean
  );
[0m13:26:58.378452 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "brightwheel_exam.source1" does not exist
LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                           ^

[0m13:26:58.378610 [debug] [Thread-1 (]: On model.brightwheel.source1: ROLLBACK
[0m13:26:58.378858 [debug] [Thread-1 (]: On model.brightwheel.source1: Close
[0m13:26:58.383020 [debug] [Thread-1 (]: Database Error in model source1 (models/0_staging/third_party/source1.sql)
  relation "brightwheel_exam.source1" does not exist
  LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                             ^
  compiled Code at target/run/brightwheel/models/0_staging/third_party/source1.sql
[0m13:26:58.383752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0606236f-1943-4957-9ad6-818ca46c056c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104f09b0>]}
[0m13:26:58.384045 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model brightwheel_exam.source1 .................. [[31mERROR[0m in 0.03s]
[0m13:26:58.384337 [debug] [Thread-1 (]: Finished running node model.brightwheel.source1
[0m13:26:58.385269 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.385424 [debug] [MainThread]: On master: BEGIN
[0m13:26:58.385544 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:26:58.393079 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:26:58.393284 [debug] [MainThread]: On master: COMMIT
[0m13:26:58.393413 [debug] [MainThread]: Using postgres connection "master"
[0m13:26:58.393532 [debug] [MainThread]: On master: COMMIT
[0m13:26:58.393779 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:26:58.394076 [debug] [MainThread]: On master: Close
[0m13:26:58.394336 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:26:58.394468 [debug] [MainThread]: Connection 'model.brightwheel.source1' was properly closed.
[0m13:26:58.394611 [info ] [MainThread]: 
[0m13:26:58.394758 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m13:26:58.395060 [debug] [MainThread]: Command end result
[0m13:26:58.437848 [info ] [MainThread]: 
[0m13:26:58.438140 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:26:58.438289 [info ] [MainThread]: 
[0m13:26:58.438474 [error] [MainThread]:   Database Error in model source1 (models/0_staging/third_party/source1.sql)
  relation "brightwheel_exam.source1" does not exist
  LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                             ^
  compiled Code at target/run/brightwheel/models/0_staging/third_party/source1.sql
[0m13:26:58.438619 [info ] [MainThread]: 
[0m13:26:58.438757 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:26:58.439608 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.93027544, "process_user_time": 1.334173, "process_kernel_time": 0.12195, "process_mem_max_rss": "123797504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:26:58.439859 [debug] [MainThread]: Command `dbt run` failed at 13:26:58.439818 after 0.93 seconds
[0m13:26:58.440043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107058b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102dc200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102df380>]}
[0m13:26:58.440206 [debug] [MainThread]: Flushing usage events
[0m13:29:42.650129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d6ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069c2390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069c20c0>]}


============================== 13:29:42.652285 | 51dd0eb5-35cd-43d6-a78d-1a707a432aa3 ==============================
[0m13:29:42.652285 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:29:42.652609 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m source1', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:29:42.745334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051a6360>]}
[0m13:29:42.768420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10585c230>]}
[0m13:29:42.768871 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:29:42.778030 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:29:42.835351 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:29:42.835597 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:29:42.838075 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.brightwheel.2_mart
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m13:29:42.855844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb1040>]}
[0m13:29:42.900911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10731a240>]}
[0m13:29:42.901178 [info ] [MainThread]: Found 6 models, 4 data tests, 4 sources, 417 macros
[0m13:29:42.901346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e85f0>]}
[0m13:29:42.902125 [info ] [MainThread]: 
[0m13:29:42.902415 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:29:42.902830 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:29:42.929050 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:29:42.929302 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:29:42.929448 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:42.940773 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m13:29:42.941514 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:29:42.943493 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:29:42.946424 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:29:42.946594 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:29:42.946718 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:29:42.952326 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m13:29:42.952486 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:29:42.952634 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:29:42.959169 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m13:29:42.959761 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:29:42.960083 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:29:42.962216 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:42.962386 [debug] [MainThread]: On master: BEGIN
[0m13:29:42.962510 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:29:42.966334 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:29:42.966482 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:42.966664 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:29:42.971505 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m13:29:42.972122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aa17c0>]}
[0m13:29:42.972357 [debug] [MainThread]: On master: ROLLBACK
[0m13:29:42.972660 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:42.972786 [debug] [MainThread]: On master: BEGIN
[0m13:29:42.973275 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:29:42.973413 [debug] [MainThread]: On master: COMMIT
[0m13:29:42.973528 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:42.973638 [debug] [MainThread]: On master: COMMIT
[0m13:29:42.973894 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:29:42.974018 [debug] [MainThread]: On master: Close
[0m13:29:42.974200 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:29:42.974450 [info ] [MainThread]: 
[0m13:29:42.975530 [debug] [Thread-1 (]: Began running node model.brightwheel.source1
[0m13:29:42.975781 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.source1 ........................... [RUN]
[0m13:29:42.975986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.source1)
[0m13:29:42.976144 [debug] [Thread-1 (]: Began compiling node model.brightwheel.source1
[0m13:29:42.980057 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.source1"
[0m13:29:42.980548 [debug] [Thread-1 (]: Began executing node model.brightwheel.source1
[0m13:29:42.999270 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.source1"
[0m13:29:42.999838 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:29:43.000000 [debug] [Thread-1 (]: On model.brightwheel.source1: BEGIN
[0m13:29:43.000148 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:29:43.006779 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m13:29:43.006942 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:29:43.007102 [debug] [Thread-1 (]: On model.brightwheel.source1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source1"} */

  create view "brightwheel"."brightwheel_exam"."source1__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/source1

with source as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

clean as (

    select
        name,
        credential_type,
        credential_number,
        status,
        expiration_date,
        disciplinary_action,
        address,
        state,
        county,
        phone,
        first_issue_date,
        primary_contact_name,
        primary_contact_role

    from source

)

select * from clean
  );
[0m13:29:43.007726 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "brightwheel_exam.source1" does not exist
LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                           ^

[0m13:29:43.007880 [debug] [Thread-1 (]: On model.brightwheel.source1: ROLLBACK
[0m13:29:43.008182 [debug] [Thread-1 (]: On model.brightwheel.source1: Close
[0m13:29:43.010265 [debug] [Thread-1 (]: Database Error in model source1 (models/0_staging/third_party/source1.sql)
  relation "brightwheel_exam.source1" does not exist
  LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                             ^
  compiled Code at target/run/brightwheel/models/0_staging/third_party/source1.sql
[0m13:29:43.010992 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51dd0eb5-35cd-43d6-a78d-1a707a432aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f61a00>]}
[0m13:29:43.011295 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model brightwheel_exam.source1 .................. [[31mERROR[0m in 0.03s]
[0m13:29:43.011578 [debug] [Thread-1 (]: Finished running node model.brightwheel.source1
[0m13:29:43.012556 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:43.012743 [debug] [MainThread]: On master: BEGIN
[0m13:29:43.012871 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:29:43.017751 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:29:43.017943 [debug] [MainThread]: On master: COMMIT
[0m13:29:43.018067 [debug] [MainThread]: Using postgres connection "master"
[0m13:29:43.018183 [debug] [MainThread]: On master: COMMIT
[0m13:29:43.018405 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:29:43.018532 [debug] [MainThread]: On master: Close
[0m13:29:43.018716 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:29:43.018832 [debug] [MainThread]: Connection 'model.brightwheel.source1' was properly closed.
[0m13:29:43.018976 [info ] [MainThread]: 
[0m13:29:43.019129 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m13:29:43.019444 [debug] [MainThread]: Command end result
[0m13:29:43.032508 [info ] [MainThread]: 
[0m13:29:43.032793 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:29:43.032941 [info ] [MainThread]: 
[0m13:29:43.033127 [error] [MainThread]:   Database Error in model source1 (models/0_staging/third_party/source1.sql)
  relation "brightwheel_exam.source1" does not exist
  LINE 11:     select * from "brightwheel"."brightwheel_exam"."source1"
                             ^
  compiled Code at target/run/brightwheel/models/0_staging/third_party/source1.sql
[0m13:29:43.033268 [info ] [MainThread]: 
[0m13:29:43.033409 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:29:43.034249 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.41264072, "process_user_time": 0.859797, "process_kernel_time": 0.11343, "process_mem_max_rss": "119046144", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:29:43.034546 [debug] [MainThread]: Command `dbt run` failed at 13:29:43.034500 after 0.41 seconds
[0m13:29:43.034744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065fcb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107358b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069c2390>]}
[0m13:29:43.034912 [debug] [MainThread]: Flushing usage events
[0m13:32:24.807642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d41bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ede450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ede180>]}


============================== 13:32:24.810297 | 52b0c91a-9fbc-44b9-b2c2-daaa61f27095 ==============================
[0m13:32:24.810297 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:32:24.810609 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run -m source1', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:32:24.911685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037da540>]}
[0m13:32:24.934248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fc1730>]}
[0m13:32:24.935170 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:32:24.945336 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:32:25.008655 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m13:32:25.009180 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/0_staging/salesforce/sources.yml
[0m13:32:25.009504 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/0_staging/third_party/sources.yml
[0m13:32:25.150148 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.brightwheel.2_mart
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m13:32:25.155301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106361dc0>]}
[0m13:32:25.204400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106871580>]}
[0m13:32:25.204712 [info ] [MainThread]: Found 6 models, 4 data tests, 4 sources, 417 macros
[0m13:32:25.204881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c38530>]}
[0m13:32:25.205658 [info ] [MainThread]: 
[0m13:32:25.205944 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:32:25.206391 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:32:25.235791 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:32:25.236034 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:32:25.236179 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:32:25.253210 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.017 seconds
[0m13:32:25.253978 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:32:25.256024 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:32:25.259003 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:32:25.259162 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:32:25.259308 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:32:25.262953 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m13:32:25.263134 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:32:25.263282 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:32:25.266580 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m13:32:25.267155 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:32:25.267388 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:32:25.269546 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.269716 [debug] [MainThread]: On master: BEGIN
[0m13:32:25.269841 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:32:25.275790 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:32:25.275936 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.276124 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:32:25.282903 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m13:32:25.283508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068fbe30>]}
[0m13:32:25.283719 [debug] [MainThread]: On master: ROLLBACK
[0m13:32:25.283974 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.284094 [debug] [MainThread]: On master: BEGIN
[0m13:32:25.284519 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:32:25.284642 [debug] [MainThread]: On master: COMMIT
[0m13:32:25.284755 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.284866 [debug] [MainThread]: On master: COMMIT
[0m13:32:25.285114 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:32:25.285235 [debug] [MainThread]: On master: Close
[0m13:32:25.285418 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:32:25.285564 [info ] [MainThread]: 
[0m13:32:25.286769 [debug] [Thread-1 (]: Began running node model.brightwheel.source1
[0m13:32:25.287017 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.source1 ........................... [RUN]
[0m13:32:25.287219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.source1)
[0m13:32:25.287375 [debug] [Thread-1 (]: Began compiling node model.brightwheel.source1
[0m13:32:25.291132 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.source1"
[0m13:32:25.291546 [debug] [Thread-1 (]: Began executing node model.brightwheel.source1
[0m13:32:25.309170 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.source1"
[0m13:32:25.309711 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:32:25.309875 [debug] [Thread-1 (]: On model.brightwheel.source1: BEGIN
[0m13:32:25.310018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:32:25.314136 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m13:32:25.314344 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:32:25.314509 [debug] [Thread-1 (]: On model.brightwheel.source1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source1"} */

  create view "brightwheel"."brightwheel_exam"."source1__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/source1

with source as (

    select * from "brightwheel"."public"."source1"

),

clean as (

    select
        name,
        credential_type,
        credential_number,
        status,
        expiration_date,
        disciplinary_action,
        address,
        state,
        county,
        phone,
        first_issue_date,
        primary_contact_name,
        primary_contact_role

    from source

)

select * from clean
  );
[0m13:32:25.320685 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m13:32:25.323954 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:32:25.324146 [debug] [Thread-1 (]: On model.brightwheel.source1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source1"} */
alter table "brightwheel"."brightwheel_exam"."source1__dbt_tmp" rename to "source1"
[0m13:32:25.324812 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:32:25.331897 [debug] [Thread-1 (]: On model.brightwheel.source1: COMMIT
[0m13:32:25.332090 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:32:25.332241 [debug] [Thread-1 (]: On model.brightwheel.source1: COMMIT
[0m13:32:25.333468 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:32:25.336298 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."source1__dbt_backup"
[0m13:32:25.338594 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source1"
[0m13:32:25.338767 [debug] [Thread-1 (]: On model.brightwheel.source1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source1"} */
drop view if exists "brightwheel"."brightwheel_exam"."source1__dbt_backup" cascade
[0m13:32:25.339188 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:32:25.340248 [debug] [Thread-1 (]: On model.brightwheel.source1: Close
[0m13:32:25.340893 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '52b0c91a-9fbc-44b9-b2c2-daaa61f27095', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037d9850>]}
[0m13:32:25.341166 [info ] [Thread-1 (]: 1 of 1 OK created sql view model brightwheel_exam.source1 ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m13:32:25.341446 [debug] [Thread-1 (]: Finished running node model.brightwheel.source1
[0m13:32:25.342003 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.342130 [debug] [MainThread]: On master: BEGIN
[0m13:32:25.342239 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:32:25.347836 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:32:25.348029 [debug] [MainThread]: On master: COMMIT
[0m13:32:25.348163 [debug] [MainThread]: Using postgres connection "master"
[0m13:32:25.348275 [debug] [MainThread]: On master: COMMIT
[0m13:32:25.348535 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:32:25.348655 [debug] [MainThread]: On master: Close
[0m13:32:25.348828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:32:25.348939 [debug] [MainThread]: Connection 'model.brightwheel.source1' was properly closed.
[0m13:32:25.349079 [info ] [MainThread]: 
[0m13:32:25.349232 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.14 seconds (0.14s).
[0m13:32:25.349546 [debug] [MainThread]: Command end result
[0m13:32:25.363114 [info ] [MainThread]: 
[0m13:32:25.363391 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:32:25.363537 [info ] [MainThread]: 
[0m13:32:25.363687 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:32:25.365389 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5885896, "process_user_time": 1.001962, "process_kernel_time": 0.134064, "process_mem_max_rss": "122994688", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:32:25.365778 [debug] [MainThread]: Command `dbt run` succeeded at 13:32:25.365725 after 0.59 seconds
[0m13:32:25.365993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ede180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c5adb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e96d20>]}
[0m13:32:25.366178 [debug] [MainThread]: Flushing usage events
[0m13:34:01.722080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108565670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088013a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085e9280>]}


============================== 13:34:01.724814 | 589026a4-14fb-468c-93cf-c30a3a8dc9c8 ==============================
[0m13:34:01.724814 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:34:01.725131 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -m salesforce_leads', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:34:01.827168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073923f0>]}
[0m13:34:01.850073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de8aa0>]}
[0m13:34:01.851036 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:34:01.861425 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:34:01.924241 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:34:01.924599 [debug] [MainThread]: Partial parsing: added file: brightwheel://models/2_mart/leads.sql
[0m13:34:02.026381 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m13:34:02.032154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10943fec0>]}
[0m13:34:02.081106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093a68a0>]}
[0m13:34:02.081414 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m13:34:02.081588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109425f10>]}
[0m13:34:02.082378 [info ] [MainThread]: 
[0m13:34:02.082660 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:34:02.083082 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:34:02.111962 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:34:02.112192 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:34:02.112330 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:02.128903 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.017 seconds
[0m13:34:02.129682 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:34:02.131705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:34:02.134577 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:02.134739 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:34:02.134865 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:34:02.139262 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m13:34:02.139411 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:02.139555 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:34:02.142891 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m13:34:02.143490 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:34:02.143842 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:34:02.146048 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.146204 [debug] [MainThread]: On master: BEGIN
[0m13:34:02.146324 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:34:02.149874 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:34:02.150013 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.150187 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:34:02.158381 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m13:34:02.159020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096abf50>]}
[0m13:34:02.159234 [debug] [MainThread]: On master: ROLLBACK
[0m13:34:02.159502 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.159624 [debug] [MainThread]: On master: BEGIN
[0m13:34:02.160130 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:34:02.160255 [debug] [MainThread]: On master: COMMIT
[0m13:34:02.160411 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.160534 [debug] [MainThread]: On master: COMMIT
[0m13:34:02.160821 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:02.160945 [debug] [MainThread]: On master: Close
[0m13:34:02.161134 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:34:02.161275 [info ] [MainThread]: 
[0m13:34:02.162519 [debug] [Thread-1 (]: Began running node model.brightwheel.salesforce_leads
[0m13:34:02.162764 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.salesforce_leads .................. [RUN]
[0m13:34:02.162963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.salesforce_leads)
[0m13:34:02.163123 [debug] [Thread-1 (]: Began compiling node model.brightwheel.salesforce_leads
[0m13:34:02.166887 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.salesforce_leads"
[0m13:34:02.167345 [debug] [Thread-1 (]: Began executing node model.brightwheel.salesforce_leads
[0m13:34:02.185207 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.salesforce_leads"
[0m13:34:02.185824 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:02.185995 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: BEGIN
[0m13:34:02.186146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:34:02.190739 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m13:34:02.190913 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:02.191085 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */

  create view "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/salesforce_leads

with source as (

    select * from "brightwheel"."public"."salesforce_leads"

),

clean as (
    select
        id,
        is_deleted,
        last_name,
        first_name,
        title,
        company,
        street,
        city,
        state,
        postal_code,
        country,
        phone,
        mobile_phone,
        email,
        website,
        lead_source,
        status,
        is_converted,
        created_date,
        last_modified_date,
        last_activity_date,
        last_viewed_date,
        last_referenced_date,
        email_bounced_reason,
        email_bounced_date,
        outreach_stage_c as outreach_stage,
        current_enrollment_c as current_enrollment,
        capacity_c as capacity,
        lead_source_last_updated_c as lead_source_last_updated,
        brightwheel_school_uuid_c as brightwheel_school_uuid_c as brightwheel_school_uuid

    from source

)

select * from clean
  );
[0m13:34:02.191479 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "as"
LINE 46: ...twheel_school_uuid_c as brightwheel_school_uuid_c as brightw...
                                                              ^

[0m13:34:02.191627 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: ROLLBACK
[0m13:34:02.191866 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: Close
[0m13:34:02.196130 [debug] [Thread-1 (]: Database Error in model salesforce_leads (models/0_staging/salesforce/salesforce_leads.sql)
  syntax error at or near "as"
  LINE 46: ...twheel_school_uuid_c as brightwheel_school_uuid_c as brightw...
                                                                ^
  compiled Code at target/run/brightwheel/models/0_staging/salesforce/salesforce_leads.sql
[0m13:34:02.196914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '589026a4-14fb-468c-93cf-c30a3a8dc9c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096a92b0>]}
[0m13:34:02.197246 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model brightwheel_exam.salesforce_leads ......... [[31mERROR[0m in 0.03s]
[0m13:34:02.197547 [debug] [Thread-1 (]: Finished running node model.brightwheel.salesforce_leads
[0m13:34:02.198420 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.198579 [debug] [MainThread]: On master: BEGIN
[0m13:34:02.198700 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:34:02.204934 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m13:34:02.205118 [debug] [MainThread]: On master: COMMIT
[0m13:34:02.205243 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:02.205362 [debug] [MainThread]: On master: COMMIT
[0m13:34:02.205579 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:02.205747 [debug] [MainThread]: On master: Close
[0m13:34:02.205943 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:02.206061 [debug] [MainThread]: Connection 'model.brightwheel.salesforce_leads' was properly closed.
[0m13:34:02.206212 [info ] [MainThread]: 
[0m13:34:02.206531 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m13:34:02.206900 [debug] [MainThread]: Command end result
[0m13:34:02.220730 [info ] [MainThread]: 
[0m13:34:02.221044 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:34:02.221204 [info ] [MainThread]: 
[0m13:34:02.221392 [error] [MainThread]:   Database Error in model salesforce_leads (models/0_staging/salesforce/salesforce_leads.sql)
  syntax error at or near "as"
  LINE 46: ...twheel_school_uuid_c as brightwheel_school_uuid_c as brightw...
                                                                ^
  compiled Code at target/run/brightwheel/models/0_staging/salesforce/salesforce_leads.sql
[0m13:34:02.221549 [info ] [MainThread]: 
[0m13:34:02.221696 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:34:02.223268 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.53246707, "process_user_time": 0.952848, "process_kernel_time": 0.142504, "process_mem_max_rss": "122519552", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:34:02.223672 [debug] [MainThread]: Command `dbt run` failed at 13:34:02.223585 after 0.53 seconds
[0m13:34:02.223971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10884a000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083bd730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108565670>]}
[0m13:34:02.224167 [debug] [MainThread]: Flushing usage events
[0m13:34:25.406705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105944770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e23c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e20f0>]}


============================== 13:34:25.409608 | 09492b78-a9aa-4b9b-ab9d-4f791daf0eb1 ==============================
[0m13:34:25.409608 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:34:25.409927 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run -m salesforce_leads', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:34:25.514146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df25a0>]}
[0m13:34:25.536800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ac3260>]}
[0m13:34:25.537888 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:34:25.548226 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:34:25.610373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:34:25.610750 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/0_staging/salesforce/salesforce_leads.sql
[0m13:34:25.710117 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m13:34:25.716212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d4c1a0>]}
[0m13:34:25.765189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d4fc80>]}
[0m13:34:25.765505 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m13:34:25.765671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df37d0>]}
[0m13:34:25.766473 [info ] [MainThread]: 
[0m13:34:25.766761 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:34:25.767192 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:34:25.794459 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:34:25.794698 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:34:25.794836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:25.821118 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.026 seconds
[0m13:34:25.821996 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:34:25.824203 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:34:25.827296 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:25.827469 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:34:25.827599 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:34:25.831425 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m13:34:25.831575 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:25.831719 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:34:25.835822 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m13:34:25.836442 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:34:25.836701 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:34:25.839059 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.839217 [debug] [MainThread]: On master: BEGIN
[0m13:34:25.839342 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:34:25.843602 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:34:25.843744 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.843929 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:34:25.852155 [debug] [MainThread]: SQL status: SELECT 1 in 0.008 seconds
[0m13:34:25.852761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104245ac0>]}
[0m13:34:25.852989 [debug] [MainThread]: On master: ROLLBACK
[0m13:34:25.853295 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.853427 [debug] [MainThread]: On master: BEGIN
[0m13:34:25.853896 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:34:25.854030 [debug] [MainThread]: On master: COMMIT
[0m13:34:25.854149 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.854263 [debug] [MainThread]: On master: COMMIT
[0m13:34:25.854538 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:25.854713 [debug] [MainThread]: On master: Close
[0m13:34:25.854931 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:34:25.855089 [info ] [MainThread]: 
[0m13:34:25.856390 [debug] [Thread-1 (]: Began running node model.brightwheel.salesforce_leads
[0m13:34:25.856644 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.salesforce_leads .................. [RUN]
[0m13:34:25.856851 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.salesforce_leads)
[0m13:34:25.857021 [debug] [Thread-1 (]: Began compiling node model.brightwheel.salesforce_leads
[0m13:34:25.861029 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.salesforce_leads"
[0m13:34:25.861529 [debug] [Thread-1 (]: Began executing node model.brightwheel.salesforce_leads
[0m13:34:25.879202 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.salesforce_leads"
[0m13:34:25.879789 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:25.879967 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: BEGIN
[0m13:34:25.880115 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:34:25.886039 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m13:34:25.886212 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:25.886395 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */

  create view "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/salesforce_leads

with source as (

    select * from "brightwheel"."public"."salesforce_leads"

),

clean as (
    select
        id,
        is_deleted,
        last_name,
        first_name,
        title,
        company,
        street,
        city,
        state,
        postal_code,
        country,
        phone,
        mobile_phone,
        email,
        website,
        lead_source,
        status,
        is_converted,
        created_date,
        last_modified_date,
        last_activity_date,
        last_viewed_date,
        last_referenced_date,
        email_bounced_reason,
        email_bounced_date,
        outreach_stage_c as outreach_stage,
        current_enrollment_c as current_enrollment,
        capacity_c as capacity,
        lead_source_last_updated_c as lead_source_last_updated,
        brightwheel_school_uuid_c as brightwheel_school_uuid

    from source

)

select * from clean
  );
[0m13:34:25.891529 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m13:34:25.895058 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:25.895270 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
alter table "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp" rename to "salesforce_leads"
[0m13:34:25.896067 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:34:25.903211 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m13:34:25.903407 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:25.903558 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m13:34:25.904398 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:34:25.907264 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup"
[0m13:34:25.909511 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m13:34:25.909684 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
drop view if exists "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup" cascade
[0m13:34:25.910113 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:34:25.911246 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: Close
[0m13:34:25.911921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09492b78-a9aa-4b9b-ab9d-4f791daf0eb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10836f650>]}
[0m13:34:25.912231 [info ] [Thread-1 (]: 1 of 1 OK created sql view model brightwheel_exam.salesforce_leads ............. [[32mCREATE VIEW[0m in 0.05s]
[0m13:34:25.912527 [debug] [Thread-1 (]: Finished running node model.brightwheel.salesforce_leads
[0m13:34:25.913138 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.913283 [debug] [MainThread]: On master: BEGIN
[0m13:34:25.913405 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:34:25.916977 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:34:25.917131 [debug] [MainThread]: On master: COMMIT
[0m13:34:25.917246 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:25.917357 [debug] [MainThread]: On master: COMMIT
[0m13:34:25.917556 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:25.917686 [debug] [MainThread]: On master: Close
[0m13:34:25.917878 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:25.918027 [debug] [MainThread]: Connection 'model.brightwheel.salesforce_leads' was properly closed.
[0m13:34:25.918167 [info ] [MainThread]: 
[0m13:34:25.918319 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m13:34:25.918689 [debug] [MainThread]: Command end result
[0m13:34:25.932533 [info ] [MainThread]: 
[0m13:34:25.932802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:34:25.932944 [info ] [MainThread]: 
[0m13:34:25.933087 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:34:25.934518 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5609449, "process_user_time": 0.987253, "process_kernel_time": 0.119754, "process_mem_max_rss": "120979456", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:34:25.934947 [debug] [MainThread]: Command `dbt run` succeeded at 13:34:25.934889 after 0.56 seconds
[0m13:34:25.935168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105944770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059903e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e2390>]}
[0m13:34:25.935359 [debug] [MainThread]: Flushing usage events
[0m13:34:55.453827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10661efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926090>]}


============================== 13:34:55.456288 | 4d0ddba6-72ac-46cb-82ed-e9efe72afc21 ==============================
[0m13:34:55.456288 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:34:55.456689 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m source2', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:34:55.553355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dda390>]}
[0m13:34:55.577295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b6180>]}
[0m13:34:55.577821 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:34:55.586871 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:34:55.643162 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:34:55.643536 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:34:55.646104 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m13:34:55.665415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e74c20>]}
[0m13:34:55.711363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107402600>]}
[0m13:34:55.711647 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m13:34:55.711814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0ef60>]}
[0m13:34:55.712603 [info ] [MainThread]: 
[0m13:34:55.712892 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:34:55.713291 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:34:55.737235 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:34:55.737491 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:34:55.737647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:55.749216 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m13:34:55.750004 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:34:55.752154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:34:55.755099 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:55.755263 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:34:55.755398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:34:55.761824 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m13:34:55.761983 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:55.762130 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:34:55.768756 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.006 seconds
[0m13:34:55.769459 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:34:55.769808 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:34:55.772211 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.772385 [debug] [MainThread]: On master: BEGIN
[0m13:34:55.772518 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:34:55.777956 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:34:55.778148 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.778341 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:34:55.786201 [debug] [MainThread]: SQL status: SELECT 2 in 0.008 seconds
[0m13:34:55.786917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ddb620>]}
[0m13:34:55.787159 [debug] [MainThread]: On master: ROLLBACK
[0m13:34:55.787450 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.787584 [debug] [MainThread]: On master: BEGIN
[0m13:34:55.788025 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:34:55.788159 [debug] [MainThread]: On master: COMMIT
[0m13:34:55.788279 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.788398 [debug] [MainThread]: On master: COMMIT
[0m13:34:55.788629 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:55.788761 [debug] [MainThread]: On master: Close
[0m13:34:55.788974 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:34:55.789132 [info ] [MainThread]: 
[0m13:34:55.790266 [debug] [Thread-1 (]: Began running node model.brightwheel.source2
[0m13:34:55.790543 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.source2 ........................... [RUN]
[0m13:34:55.790764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.source2)
[0m13:34:55.790928 [debug] [Thread-1 (]: Began compiling node model.brightwheel.source2
[0m13:34:55.795017 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.source2"
[0m13:34:55.795525 [debug] [Thread-1 (]: Began executing node model.brightwheel.source2
[0m13:34:55.814347 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.source2"
[0m13:34:55.814931 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source2"
[0m13:34:55.815101 [debug] [Thread-1 (]: On model.brightwheel.source2: BEGIN
[0m13:34:55.815252 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:34:55.822554 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m13:34:55.822722 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source2"
[0m13:34:55.822895 [debug] [Thread-1 (]: On model.brightwheel.source2: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source2"} */

  create view "brightwheel"."brightwheel_exam"."source2__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/source2

with source as (

    select * from "brightwheel"."public"."source2"

),

clean as (
    select
        type_license,
        company,
        accepts_subsidy,
        year_round,
        daytime_hours,
        star_level,
        mon,
        tues,
        wed,
        thurs,
        friday,
        saturday,
        sunday,
        primary_caregiver,
        phone,
        email,
        address1,
        address2,
        city,
        state,
        zip,
        subsidy_contract_number,
        total_cap,
        ages_accepted_1,
        aa2 as ages_accepted_2,
        aa3 as ages_accepted_3,
        aa4 as ages_accepted_4,
        license_monitoring_since,
        school_year_only,
        evening_hours

    from source

)

select * from clean
  );
[0m13:34:55.831356 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m13:34:55.834668 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source2"
[0m13:34:55.834933 [debug] [Thread-1 (]: On model.brightwheel.source2: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source2"} */
alter table "brightwheel"."brightwheel_exam"."source2__dbt_tmp" rename to "source2"
[0m13:34:55.835763 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:34:55.843141 [debug] [Thread-1 (]: On model.brightwheel.source2: COMMIT
[0m13:34:55.843370 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source2"
[0m13:34:55.843524 [debug] [Thread-1 (]: On model.brightwheel.source2: COMMIT
[0m13:34:55.844623 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:34:55.847560 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."source2__dbt_backup"
[0m13:34:55.849931 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source2"
[0m13:34:55.850110 [debug] [Thread-1 (]: On model.brightwheel.source2: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source2"} */
drop view if exists "brightwheel"."brightwheel_exam"."source2__dbt_backup" cascade
[0m13:34:55.850518 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:34:55.851730 [debug] [Thread-1 (]: On model.brightwheel.source2: Close
[0m13:34:55.852432 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d0ddba6-72ac-46cb-82ed-e9efe72afc21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107419f70>]}
[0m13:34:55.852725 [info ] [Thread-1 (]: 1 of 1 OK created sql view model brightwheel_exam.source2 ...................... [[32mCREATE VIEW[0m in 0.06s]
[0m13:34:55.853015 [debug] [Thread-1 (]: Finished running node model.brightwheel.source2
[0m13:34:55.853612 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.853792 [debug] [MainThread]: On master: BEGIN
[0m13:34:55.853925 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:34:55.859028 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:34:55.859182 [debug] [MainThread]: On master: COMMIT
[0m13:34:55.859311 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:55.859616 [debug] [MainThread]: On master: COMMIT
[0m13:34:55.859963 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:55.860147 [debug] [MainThread]: On master: Close
[0m13:34:55.860377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:55.860502 [debug] [MainThread]: Connection 'model.brightwheel.source2' was properly closed.
[0m13:34:55.860644 [info ] [MainThread]: 
[0m13:34:55.860813 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m13:34:55.861143 [debug] [MainThread]: Command end result
[0m13:34:55.874180 [info ] [MainThread]: 
[0m13:34:55.874437 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:34:55.874582 [info ] [MainThread]: 
[0m13:34:55.874738 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:34:55.875588 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.45405522, "process_user_time": 0.910165, "process_kernel_time": 0.108335, "process_mem_max_rss": "118931456", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:34:55.875874 [debug] [MainThread]: Command `dbt run` succeeded at 13:34:55.875831 after 0.45 seconds
[0m13:34:55.876057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a05850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107806150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926270>]}
[0m13:34:55.876213 [debug] [MainThread]: Flushing usage events
[0m13:34:59.174137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11857ff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a1e4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a1e1e0>]}


============================== 13:34:59.176479 | 564e9f97-fa49-4239-bb3f-2463f554230b ==============================
[0m13:34:59.176479 [info ] [MainThread]: Running with dbt=1.8.5
[0m13:34:59.176791 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m source3', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:34:59.269315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119ac5730>]}
[0m13:34:59.292159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185f5d00>]}
[0m13:34:59.292575 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:34:59.301149 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m13:34:59.356877 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:34:59.357138 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:34:59.359699 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m13:34:59.378085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f53b00>]}
[0m13:34:59.423536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a532e10>]}
[0m13:34:59.423851 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m13:34:59.424049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f3ac60>]}
[0m13:34:59.424891 [info ] [MainThread]: 
[0m13:34:59.425214 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:34:59.425669 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m13:34:59.449652 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m13:34:59.449906 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m13:34:59.450052 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:59.461451 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m13:34:59.462192 [debug] [ThreadPool]: On list_brightwheel: Close
[0m13:34:59.464223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m13:34:59.467172 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:59.467338 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m13:34:59.467485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:34:59.471784 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m13:34:59.471956 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m13:34:59.472098 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m13:34:59.476193 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.004 seconds
[0m13:34:59.476805 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m13:34:59.477056 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m13:34:59.479364 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.479525 [debug] [MainThread]: On master: BEGIN
[0m13:34:59.479650 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:34:59.483359 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:34:59.483502 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.483702 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:34:59.490776 [debug] [MainThread]: SQL status: SELECT 3 in 0.007 seconds
[0m13:34:59.491432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a8a98b0>]}
[0m13:34:59.491648 [debug] [MainThread]: On master: ROLLBACK
[0m13:34:59.491903 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.492024 [debug] [MainThread]: On master: BEGIN
[0m13:34:59.492404 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:34:59.492535 [debug] [MainThread]: On master: COMMIT
[0m13:34:59.492650 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.492770 [debug] [MainThread]: On master: COMMIT
[0m13:34:59.492978 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:59.493102 [debug] [MainThread]: On master: Close
[0m13:34:59.493301 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:34:59.493444 [info ] [MainThread]: 
[0m13:34:59.494460 [debug] [Thread-1 (]: Began running node model.brightwheel.source3
[0m13:34:59.494700 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.source3 ........................... [RUN]
[0m13:34:59.494901 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.source3)
[0m13:34:59.495057 [debug] [Thread-1 (]: Began compiling node model.brightwheel.source3
[0m13:34:59.499162 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.source3"
[0m13:34:59.499628 [debug] [Thread-1 (]: Began executing node model.brightwheel.source3
[0m13:34:59.518988 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.source3"
[0m13:34:59.519558 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source3"
[0m13:34:59.519725 [debug] [Thread-1 (]: On model.brightwheel.source3: BEGIN
[0m13:34:59.519868 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:34:59.525778 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m13:34:59.526020 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source3"
[0m13:34:59.526207 [debug] [Thread-1 (]: On model.brightwheel.source3: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source3"} */

  create view "brightwheel"."brightwheel_exam"."source3__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/source3

with source as (

    select * from "brightwheel"."public"."source3"

),

clean as (
    select
        operation,
        agency_number,
        operation_name,
        address,
        city,
        state,
        zip,
        county,
        phone,
        type,
        status,
        issue_date,
        capacity,
        email_address,
        facility_id,
        monitoring_frequency,
        infant,
        toddler,
        preschool,
        school

    from source

)

select * from clean
  );
[0m13:34:59.530243 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m13:34:59.533734 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source3"
[0m13:34:59.534037 [debug] [Thread-1 (]: On model.brightwheel.source3: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source3"} */
alter table "brightwheel"."brightwheel_exam"."source3__dbt_tmp" rename to "source3"
[0m13:34:59.534676 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m13:34:59.541704 [debug] [Thread-1 (]: On model.brightwheel.source3: COMMIT
[0m13:34:59.541954 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source3"
[0m13:34:59.542111 [debug] [Thread-1 (]: On model.brightwheel.source3: COMMIT
[0m13:34:59.542837 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:34:59.545774 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."source3__dbt_backup"
[0m13:34:59.548201 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.source3"
[0m13:34:59.548396 [debug] [Thread-1 (]: On model.brightwheel.source3: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.source3"} */
drop view if exists "brightwheel"."brightwheel_exam"."source3__dbt_backup" cascade
[0m13:34:59.548797 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m13:34:59.550003 [debug] [Thread-1 (]: On model.brightwheel.source3: Close
[0m13:34:59.550700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564e9f97-fa49-4239-bb3f-2463f554230b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a779a90>]}
[0m13:34:59.551010 [info ] [Thread-1 (]: 1 of 1 OK created sql view model brightwheel_exam.source3 ...................... [[32mCREATE VIEW[0m in 0.06s]
[0m13:34:59.551309 [debug] [Thread-1 (]: Finished running node model.brightwheel.source3
[0m13:34:59.552114 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.552335 [debug] [MainThread]: On master: BEGIN
[0m13:34:59.552463 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:34:59.557513 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m13:34:59.557733 [debug] [MainThread]: On master: COMMIT
[0m13:34:59.557862 [debug] [MainThread]: Using postgres connection "master"
[0m13:34:59.557984 [debug] [MainThread]: On master: COMMIT
[0m13:34:59.558251 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:34:59.558420 [debug] [MainThread]: On master: Close
[0m13:34:59.558616 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:59.558741 [debug] [MainThread]: Connection 'model.brightwheel.source3' was properly closed.
[0m13:34:59.558883 [info ] [MainThread]: 
[0m13:34:59.559028 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m13:34:59.559327 [debug] [MainThread]: Command end result
[0m13:34:59.572457 [info ] [MainThread]: 
[0m13:34:59.572770 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:34:59.572930 [info ] [MainThread]: 
[0m13:34:59.573091 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:34:59.574016 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.4299361, "process_user_time": 0.889349, "process_kernel_time": 0.104059, "process_mem_max_rss": "119799808", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:34:59.574394 [debug] [MainThread]: Command `dbt run` succeeded at 13:34:59.574299 after 0.43 seconds
[0m13:34:59.574635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11926bfe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a779a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a1e270>]}
[0m13:34:59.574814 [debug] [MainThread]: Flushing usage events
[0m14:16:35.532699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054193d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e330>]}


============================== 14:16:35.535459 | 12966d93-c54e-456e-a748-bb1c3ad1cf2b ==============================
[0m14:16:35.535459 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:16:35.535764 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:16:35.634896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086f5d60>]}
[0m14:16:35.657652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108345f10>]}
[0m14:16:35.658598 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:16:35.668368 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:16:35.732017 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:16:35.732408 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:16:35.831306 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:16:35.837028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e33fe0>]}
[0m14:16:35.886618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10878cd40>]}
[0m14:16:35.886926 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:16:35.887098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f3b620>]}
[0m14:16:35.887939 [info ] [MainThread]: 
[0m14:16:35.888244 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:16:35.888701 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:16:35.917333 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:16:35.917571 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:16:35.917711 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:35.930869 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.013 seconds
[0m14:16:35.931606 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:16:35.933660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:16:35.936573 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:16:35.936741 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:16:35.936866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:35.941787 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:16:35.941937 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:16:35.942075 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:16:35.949446 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:16:35.950121 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:16:35.950435 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:16:35.952897 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:35.953055 [debug] [MainThread]: On master: BEGIN
[0m14:16:35.953174 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:16:35.957233 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:16:35.957385 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:35.957568 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:16:35.964691 [debug] [MainThread]: SQL status: SELECT 4 in 0.007 seconds
[0m14:16:35.965346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e1d430>]}
[0m14:16:35.965559 [debug] [MainThread]: On master: ROLLBACK
[0m14:16:35.965809 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:35.965931 [debug] [MainThread]: On master: BEGIN
[0m14:16:35.966321 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:16:35.966447 [debug] [MainThread]: On master: COMMIT
[0m14:16:35.966567 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:35.966682 [debug] [MainThread]: On master: COMMIT
[0m14:16:35.966906 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:16:35.967029 [debug] [MainThread]: On master: Close
[0m14:16:35.967224 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:16:35.967365 [info ] [MainThread]: 
[0m14:16:35.968616 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:16:35.968884 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:16:35.969095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:16:35.969260 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:16:35.972639 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:16:35.973135 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:16:35.992885 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:16:35.993443 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:16:35.993606 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:16:35.993748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:35.997751 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:16:35.997935 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:16:35.998331 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

)

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        null as max_age,
        null as min_age,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as max_age,
        null as min_age,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        ages_accepted_1 as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        ages_accepted_1 as min_age,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

)

select
    lead_type,
    accepts_financial_aid,
    aged_served,
    capacity,
    certificate_expiration_date,
    city,
    address1,
    address2,
    company,
    phone,
    phone2,
    county,
    email,
    first_name,
    last_name,
    license_status,
    license_issued,
    license_number,
    license_type,
    licensee_name,
    max_age,
    min_age,
    provider_id,
    schedule,
    state,
    title,
    website_address,
    zip,
    facility_type


from combined
  );
  
[0m14:16:35.999016 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "combined"
LINE 36: combined as (
         ^

[0m14:16:35.999175 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:16:35.999419 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:16:36.003542 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "combined"
  LINE 36: combined as (
           ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:16:36.004271 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12966d93-c54e-456e-a748-bb1c3ad1cf2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107095d00>]}
[0m14:16:36.004579 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:16:36.004867 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:16:36.005718 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:36.005867 [debug] [MainThread]: On master: BEGIN
[0m14:16:36.005985 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:16:36.012071 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:16:36.012268 [debug] [MainThread]: On master: COMMIT
[0m14:16:36.012386 [debug] [MainThread]: Using postgres connection "master"
[0m14:16:36.012498 [debug] [MainThread]: On master: COMMIT
[0m14:16:36.012689 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:16:36.012811 [debug] [MainThread]: On master: Close
[0m14:16:36.012987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:36.013096 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:16:36.013220 [info ] [MainThread]: 
[0m14:16:36.013359 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:16:36.013652 [debug] [MainThread]: Command end result
[0m14:16:36.027707 [info ] [MainThread]: 
[0m14:16:36.027970 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:16:36.028111 [info ] [MainThread]: 
[0m14:16:36.028282 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "combined"
  LINE 36: combined as (
           ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:16:36.028410 [info ] [MainThread]: 
[0m14:16:36.028542 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:16:36.030029 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5273308, "process_user_time": 0.945422, "process_kernel_time": 0.137962, "process_mem_max_rss": "122568704", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:16:36.030414 [debug] [MainThread]: Command `dbt run` failed at 14:16:36.030357 after 0.53 seconds
[0m14:16:36.030632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107687620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10823e330>]}
[0m14:16:36.030819 [debug] [MainThread]: Flushing usage events
[0m14:17:02.796853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d460c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11841e3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11841e120>]}


============================== 14:17:02.799363 | 4316be9d-8269-42bb-9057-5e68e0c89f46 ==============================
[0m14:17:02.799363 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:17:02.799737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'profiles_dir': '/Users/paulfoote/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:17:02.892818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184c60c0>]}
[0m14:17:02.915439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184c6b10>]}
[0m14:17:02.915874 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:17:02.926264 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:17:02.982181 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:17:02.982540 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:17:03.082399 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:17:03.088387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1199f7ce0>]}
[0m14:17:03.134186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f9da60>]}
[0m14:17:03.134496 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:17:03.134662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118eff0e0>]}
[0m14:17:03.135474 [info ] [MainThread]: 
[0m14:17:03.135758 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:17:03.136178 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:17:03.160621 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:17:03.160890 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:17:03.161043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:03.179807 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.019 seconds
[0m14:17:03.180677 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:17:03.182906 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:17:03.185931 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:17:03.186110 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:17:03.186238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:03.191074 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:17:03.191214 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:17:03.191353 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:17:03.198531 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:17:03.199192 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:17:03.199535 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:17:03.202007 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.202165 [debug] [MainThread]: On master: BEGIN
[0m14:17:03.202289 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:17:03.206895 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:17:03.207038 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.207217 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:17:03.214459 [debug] [MainThread]: SQL status: SELECT 4 in 0.007 seconds
[0m14:17:03.215111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e6c560>]}
[0m14:17:03.215314 [debug] [MainThread]: On master: ROLLBACK
[0m14:17:03.215569 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.215693 [debug] [MainThread]: On master: BEGIN
[0m14:17:03.216108 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:17:03.216241 [debug] [MainThread]: On master: COMMIT
[0m14:17:03.216355 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.216466 [debug] [MainThread]: On master: COMMIT
[0m14:17:03.216670 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:03.216793 [debug] [MainThread]: On master: Close
[0m14:17:03.217010 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:17:03.217159 [info ] [MainThread]: 
[0m14:17:03.218333 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:17:03.218579 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:17:03.218777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:17:03.218932 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:17:03.222520 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:17:03.223000 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:17:03.242127 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:17:03.242673 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:17:03.242838 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:17:03.242981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:17:03.248893 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m14:17:03.249049 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:17:03.249374 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

)

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        null as max_age,
        null as min_age,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as max_age,
        null as min_age,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        ages_accepted_1 as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        ages_accepted_1 as min_age,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),
final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:17:03.250149 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "combined"
LINE 36: combined as (
         ^

[0m14:17:03.250306 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:17:03.250613 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:17:03.252701 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "combined"
  LINE 36: combined as (
           ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:17:03.253413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4316be9d-8269-42bb-9057-5e68e0c89f46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a03d5b0>]}
[0m14:17:03.253712 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:17:03.253990 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:17:03.254965 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.255140 [debug] [MainThread]: On master: BEGIN
[0m14:17:03.255269 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:17:03.259704 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:17:03.259866 [debug] [MainThread]: On master: COMMIT
[0m14:17:03.259991 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:03.260110 [debug] [MainThread]: On master: COMMIT
[0m14:17:03.260382 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:03.260530 [debug] [MainThread]: On master: Close
[0m14:17:03.260717 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:17:03.260873 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:17:03.261022 [info ] [MainThread]: 
[0m14:17:03.261178 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:17:03.261468 [debug] [MainThread]: Command end result
[0m14:17:03.275580 [info ] [MainThread]: 
[0m14:17:03.275991 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:17:03.276188 [info ] [MainThread]: 
[0m14:17:03.276378 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "combined"
  LINE 36: combined as (
           ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:17:03.276512 [info ] [MainThread]: 
[0m14:17:03.276668 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:17:03.277507 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.510825, "process_user_time": 0.955185, "process_kernel_time": 0.114941, "process_mem_max_rss": "121683968", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:17:03.277786 [debug] [MainThread]: Command `dbt run` failed at 14:17:03.277744 after 0.51 seconds
[0m14:17:03.277973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10755bc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fdbc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039f7740>]}
[0m14:17:03.278137 [debug] [MainThread]: Flushing usage events
[0m14:17:16.188186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104068e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a623f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a62120>]}


============================== 14:17:16.190608 | 9e11c9a3-d50a-40ad-968b-30bebb5a0771 ==============================
[0m14:17:16.190608 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:17:16.191033 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run -m leads', 'send_anonymous_usage_stats': 'True'}
[0m14:17:16.284986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104003c20>]}
[0m14:17:16.307755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b64920>]}
[0m14:17:16.308200 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:17:16.317798 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:17:16.375592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:17:16.375981 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:17:16.473308 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:17:16.478952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105559580>]}
[0m14:17:16.524277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b9370>]}
[0m14:17:16.524573 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:17:16.524741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053f8ec0>]}
[0m14:17:16.525558 [info ] [MainThread]: 
[0m14:17:16.525847 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:17:16.526264 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:17:16.552679 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:17:16.552962 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:17:16.553116 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:16.572596 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.019 seconds
[0m14:17:16.573430 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:17:16.575507 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:17:16.578503 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:17:16.578687 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:17:16.578819 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:16.584675 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:17:16.584834 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:17:16.584978 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:17:16.592380 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:17:16.593012 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:17:16.593322 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:17:16.595787 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.595955 [debug] [MainThread]: On master: BEGIN
[0m14:17:16.596081 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:17:16.601789 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:17:16.601937 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.602123 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:17:16.613045 [debug] [MainThread]: SQL status: SELECT 4 in 0.011 seconds
[0m14:17:16.613709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553e990>]}
[0m14:17:16.613920 [debug] [MainThread]: On master: ROLLBACK
[0m14:17:16.614192 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.614321 [debug] [MainThread]: On master: BEGIN
[0m14:17:16.614731 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:17:16.614870 [debug] [MainThread]: On master: COMMIT
[0m14:17:16.614989 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.615109 [debug] [MainThread]: On master: COMMIT
[0m14:17:16.615328 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:16.615457 [debug] [MainThread]: On master: Close
[0m14:17:16.615649 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:17:16.615798 [info ] [MainThread]: 
[0m14:17:16.616831 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:17:16.617106 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:17:16.617328 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:17:16.617505 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:17:16.621080 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:17:16.621686 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:17:16.641442 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:17:16.642000 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:17:16.642165 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:17:16.642314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:17:16.647118 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:17:16.647305 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:17:16.647652 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        null as max_age,
        null as min_age,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as max_age,
        null as min_age,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        ages_accepted_1 as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        ages_accepted_1 as min_age,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        null as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:17:16.648734 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "ages_accepted_1"
LINE 167:         ages_accepted_1 as min_age,
                  ^

[0m14:17:16.648917 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:17:16.649224 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:17:16.651285 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "ages_accepted_1"
  LINE 167:         ages_accepted_1 as min_age,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:17:16.652002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e11c9a3-d50a-40ad-968b-30bebb5a0771', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a99f70>]}
[0m14:17:16.652286 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:17:16.652568 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:17:16.653402 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.653545 [debug] [MainThread]: On master: BEGIN
[0m14:17:16.653664 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:17:16.659270 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:17:16.659445 [debug] [MainThread]: On master: COMMIT
[0m14:17:16.659566 [debug] [MainThread]: Using postgres connection "master"
[0m14:17:16.659679 [debug] [MainThread]: On master: COMMIT
[0m14:17:16.659936 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:17:16.660056 [debug] [MainThread]: On master: Close
[0m14:17:16.660221 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:17:16.660341 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:17:16.660471 [info ] [MainThread]: 
[0m14:17:16.660611 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:17:16.660901 [debug] [MainThread]: Command end result
[0m14:17:16.674702 [info ] [MainThread]: 
[0m14:17:16.675005 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:17:16.675159 [info ] [MainThread]: 
[0m14:17:16.675343 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "ages_accepted_1"
  LINE 167:         ages_accepted_1 as min_age,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:17:16.675482 [info ] [MainThread]: 
[0m14:17:16.675625 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:17:16.676587 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5187057, "process_user_time": 0.963698, "process_kernel_time": 0.118979, "process_mem_max_rss": "123486208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:17:16.676947 [debug] [MainThread]: Command `dbt run` failed at 14:17:16.676899 after 0.52 seconds
[0m14:17:16.677145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10555b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053bacf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104068e60>]}
[0m14:17:16.677314 [debug] [MainThread]: Flushing usage events
[0m14:22:41.119926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bcc0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10825e3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10825e120>]}


============================== 14:22:41.122315 | d34a41b5-8b9e-4422-a400-996f6c83c62d ==============================
[0m14:22:41.122315 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:22:41.122620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:22:41.217142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077fdd60>]}
[0m14:22:41.239753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10825e270>]}
[0m14:22:41.240159 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:22:41.250674 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:22:41.307874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:22:41.308394 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:22:41.406754 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:22:41.412396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e4ff50>]}
[0m14:22:41.457597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bf5880>]}
[0m14:22:41.457896 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:22:41.458067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e539b0>]}
[0m14:22:41.458879 [info ] [MainThread]: 
[0m14:22:41.459176 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:22:41.459582 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:22:41.485670 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:22:41.485965 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:22:41.486114 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:22:41.497684 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m14:22:41.498556 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:22:41.500774 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:22:41.503888 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:22:41.504112 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:22:41.504243 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:22:41.508750 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:22:41.508920 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:22:41.509060 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:22:41.516680 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:22:41.517513 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:22:41.518102 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:22:41.520737 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.520915 [debug] [MainThread]: On master: BEGIN
[0m14:22:41.521042 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:22:41.525833 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:22:41.525980 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.526165 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:22:41.534658 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m14:22:41.535280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10833d850>]}
[0m14:22:41.535556 [debug] [MainThread]: On master: ROLLBACK
[0m14:22:41.535817 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.535949 [debug] [MainThread]: On master: BEGIN
[0m14:22:41.536326 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:22:41.536449 [debug] [MainThread]: On master: COMMIT
[0m14:22:41.536572 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.536693 [debug] [MainThread]: On master: COMMIT
[0m14:22:41.536910 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:22:41.537041 [debug] [MainThread]: On master: Close
[0m14:22:41.537280 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:22:41.537446 [info ] [MainThread]: 
[0m14:22:41.538517 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:22:41.538766 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:22:41.538981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:22:41.539157 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:22:41.542654 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:22:41.543115 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:22:41.562541 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:22:41.563080 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:22:41.563255 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:22:41.563403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:22:41.567492 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:22:41.567676 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:22:41.568014 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, '') max_age) as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        concat(concat(min_age,' ', max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:22:41.568762 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "max_age"
LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                             ^

[0m14:22:41.568908 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:22:41.569135 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:22:41.571162 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "max_age"
  LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                               ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:22:41.571852 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd34a41b5-8b9e-4422-a400-996f6c83c62d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091edcd0>]}
[0m14:22:41.572134 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:22:41.572419 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:22:41.573325 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.573460 [debug] [MainThread]: On master: BEGIN
[0m14:22:41.573577 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:22:41.579820 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:22:41.580048 [debug] [MainThread]: On master: COMMIT
[0m14:22:41.580184 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:41.580302 [debug] [MainThread]: On master: COMMIT
[0m14:22:41.580589 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:22:41.580728 [debug] [MainThread]: On master: Close
[0m14:22:41.580914 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:22:41.581057 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:22:41.581221 [info ] [MainThread]: 
[0m14:22:41.581467 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:22:41.581949 [debug] [MainThread]: Command end result
[0m14:22:41.595733 [info ] [MainThread]: 
[0m14:22:41.595990 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:22:41.596132 [info ] [MainThread]: 
[0m14:22:41.596330 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "max_age"
  LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                               ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:22:41.596465 [info ] [MainThread]: 
[0m14:22:41.596610 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:22:41.597669 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.50789326, "process_user_time": 0.950607, "process_kernel_time": 0.117937, "process_mem_max_rss": "122847232", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:22:41.597970 [debug] [MainThread]: Command `dbt run` failed at 14:22:41.597925 after 0.51 seconds
[0m14:22:41.598163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104416c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c42c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cabd70>]}
[0m14:22:41.598328 [debug] [MainThread]: Flushing usage events
[0m14:22:53.225847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d40500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10931a420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10931a180>]}


============================== 14:22:53.228264 | 0930de08-397c-4159-b6e2-66b512c94ddd ==============================
[0m14:22:53.228264 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:22:53.228598 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run -m leads', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:22:53.321724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d11730>]}
[0m14:22:53.344463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093fdfd0>]}
[0m14:22:53.344863 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:22:53.355124 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:22:53.410932 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:22:53.411338 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:22:53.510092 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:22:53.515769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baf7e30>]}
[0m14:22:53.562249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b899430>]}
[0m14:22:53.562586 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:22:53.562762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baeda30>]}
[0m14:22:53.563569 [info ] [MainThread]: 
[0m14:22:53.563862 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:22:53.564300 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:22:53.588708 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:22:53.588985 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:22:53.589136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:22:53.606765 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.018 seconds
[0m14:22:53.607657 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:22:53.609854 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:22:53.613071 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:22:53.613328 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:22:53.613506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:22:53.620761 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:22:53.620973 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:22:53.621133 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:22:53.627953 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:22:53.628636 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:22:53.628909 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:22:53.631495 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.631651 [debug] [MainThread]: On master: BEGIN
[0m14:22:53.631769 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:22:53.636328 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:22:53.636467 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.636646 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:22:53.645361 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:22:53.645994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c062660>]}
[0m14:22:53.646204 [debug] [MainThread]: On master: ROLLBACK
[0m14:22:53.646474 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.646604 [debug] [MainThread]: On master: BEGIN
[0m14:22:53.647096 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:22:53.647227 [debug] [MainThread]: On master: COMMIT
[0m14:22:53.647345 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.647465 [debug] [MainThread]: On master: COMMIT
[0m14:22:53.647784 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:22:53.647914 [debug] [MainThread]: On master: Close
[0m14:22:53.648121 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:22:53.648273 [info ] [MainThread]: 
[0m14:22:53.649487 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:22:53.649747 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:22:53.649949 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:22:53.650144 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:22:53.653660 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:22:53.654197 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:22:53.673030 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:22:53.673538 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:22:53.673700 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:22:53.673843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:22:53.678894 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:22:53.679081 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:22:53.679427 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, '') max_age) as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:22:53.680544 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "max_age"
LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                             ^

[0m14:22:53.680700 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:22:53.680987 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:22:53.683022 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "max_age"
  LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                               ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:22:53.683712 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0930de08-397c-4159-b6e2-66b512c94ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086bd850>]}
[0m14:22:53.683995 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:22:53.684273 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:22:53.685103 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.685275 [debug] [MainThread]: On master: BEGIN
[0m14:22:53.685408 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:22:53.691332 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:22:53.691505 [debug] [MainThread]: On master: COMMIT
[0m14:22:53.691631 [debug] [MainThread]: Using postgres connection "master"
[0m14:22:53.691751 [debug] [MainThread]: On master: COMMIT
[0m14:22:53.691991 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:22:53.692121 [debug] [MainThread]: On master: Close
[0m14:22:53.692298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:22:53.692412 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:22:53.692545 [info ] [MainThread]: 
[0m14:22:53.692685 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:22:53.692977 [debug] [MainThread]: Command end result
[0m14:22:53.706671 [info ] [MainThread]: 
[0m14:22:53.706966 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:22:53.707113 [info ] [MainThread]: 
[0m14:22:53.707304 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "max_age"
  LINE 151:         concat(concat(min_age, '') max_age) as ages_served,
                                               ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:22:53.707447 [info ] [MainThread]: 
[0m14:22:53.707593 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:22:53.708468 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5117267, "process_user_time": 0.949822, "process_kernel_time": 0.11031, "process_mem_max_rss": "122716160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:22:53.708763 [debug] [MainThread]: Command `dbt run` failed at 14:22:53.708721 after 0.51 seconds
[0m14:22:53.708993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b6bec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109420b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109319c70>]}
[0m14:22:53.709160 [debug] [MainThread]: Flushing usage events
[0m14:23:07.245235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118d39580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191e2330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191e2060>]}


============================== 14:23:07.247763 | 245e07c2-f4c7-4709-98da-c901e8ef8167 ==============================
[0m14:23:07.247763 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:23:07.248069 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:23:07.342091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119208350>]}
[0m14:23:07.364440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a0df40>]}
[0m14:23:07.364857 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:23:07.374757 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:23:07.432439 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:23:07.432836 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:23:07.530478 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:23:07.536193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e9ff20>]}
[0m14:23:07.581686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119c04920>]}
[0m14:23:07.581987 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:23:07.582153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d32660>]}
[0m14:23:07.582932 [info ] [MainThread]: 
[0m14:23:07.583225 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:23:07.583647 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:23:07.607626 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:23:07.607888 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:23:07.608043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:07.619456 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m14:23:07.620365 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:23:07.622539 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:23:07.626090 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:07.626355 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:23:07.626497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:07.632654 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:23:07.632909 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:07.633070 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:23:07.640544 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:23:07.641495 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:23:07.641837 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:23:07.644637 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.644812 [debug] [MainThread]: On master: BEGIN
[0m14:23:07.644937 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:23:07.651155 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:23:07.651306 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.651483 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:23:07.660355 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:23:07.661050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119d8b740>]}
[0m14:23:07.661291 [debug] [MainThread]: On master: ROLLBACK
[0m14:23:07.661598 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.661716 [debug] [MainThread]: On master: BEGIN
[0m14:23:07.662104 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:23:07.662232 [debug] [MainThread]: On master: COMMIT
[0m14:23:07.662341 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.662453 [debug] [MainThread]: On master: COMMIT
[0m14:23:07.662672 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:07.662791 [debug] [MainThread]: On master: Close
[0m14:23:07.662992 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:23:07.663139 [info ] [MainThread]: 
[0m14:23:07.664370 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:23:07.664659 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:23:07.664888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:23:07.665054 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:23:07.668490 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:23:07.668935 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:23:07.688126 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:23:07.688704 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:07.688870 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:23:07.689017 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:23:07.693332 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:23:07.693529 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:07.693876 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:23:07.695032 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "min_age"
LINE 195:         min_age,
                  ^

[0m14:23:07.695209 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:23:07.695520 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:23:07.697590 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "min_age"
  LINE 195:         min_age,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:07.698332 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '245e07c2-f4c7-4709-98da-c901e8ef8167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a53c800>]}
[0m14:23:07.698645 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:23:07.698927 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:23:07.699808 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.699946 [debug] [MainThread]: On master: BEGIN
[0m14:23:07.700058 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:23:07.705771 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:23:07.705929 [debug] [MainThread]: On master: COMMIT
[0m14:23:07.706049 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:07.706162 [debug] [MainThread]: On master: COMMIT
[0m14:23:07.706390 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:07.706505 [debug] [MainThread]: On master: Close
[0m14:23:07.706681 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:23:07.706795 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:23:07.706920 [info ] [MainThread]: 
[0m14:23:07.707058 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:23:07.707350 [debug] [MainThread]: Command end result
[0m14:23:07.721582 [info ] [MainThread]: 
[0m14:23:07.721851 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:23:07.721998 [info ] [MainThread]: 
[0m14:23:07.722174 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  syntax error at or near "min_age"
  LINE 195:         min_age,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:07.722302 [info ] [MainThread]: 
[0m14:23:07.722439 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:23:07.723232 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.50812465, "process_user_time": 0.952379, "process_kernel_time": 0.112785, "process_mem_max_rss": "123748352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:23:07.723505 [debug] [MainThread]: Command `dbt run` failed at 14:23:07.723465 after 0.51 seconds
[0m14:23:07.723691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119ea3b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a38c0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118d39580>]}
[0m14:23:07.723853 [debug] [MainThread]: Flushing usage events
[0m14:23:26.508439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10459d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bea420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bea150>]}


============================== 14:23:26.510652 | f53e2f15-0353-47d8-9363-6c0fd3c09400 ==============================
[0m14:23:26.510652 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:23:26.510954 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:23:26.605515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10479aff0>]}
[0m14:23:26.628250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c14b90>]}
[0m14:23:26.628740 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:23:26.638291 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:23:26.694639 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:23:26.695017 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:23:26.793038 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:23:26.798684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057dbef0>]}
[0m14:23:26.843700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105543ce0>]}
[0m14:23:26.844019 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:23:26.844186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e16d0>]}
[0m14:23:26.844979 [info ] [MainThread]: 
[0m14:23:26.845269 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:23:26.845690 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:23:26.869567 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:23:26.869830 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:23:26.869982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:26.881715 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:23:26.882644 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:23:26.884843 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:23:26.888015 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:26.888287 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:23:26.888491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:26.893327 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:23:26.893548 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:26.893698 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:23:26.901591 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:23:26.902478 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:23:26.902790 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:23:26.905560 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.905731 [debug] [MainThread]: On master: BEGIN
[0m14:23:26.905852 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:23:26.911228 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:23:26.911377 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.911548 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:23:26.919902 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m14:23:26.920502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051639e0>]}
[0m14:23:26.920710 [debug] [MainThread]: On master: ROLLBACK
[0m14:23:26.920950 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.921072 [debug] [MainThread]: On master: BEGIN
[0m14:23:26.921460 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:23:26.921584 [debug] [MainThread]: On master: COMMIT
[0m14:23:26.921718 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.921847 [debug] [MainThread]: On master: COMMIT
[0m14:23:26.922050 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:26.922184 [debug] [MainThread]: On master: Close
[0m14:23:26.922373 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:23:26.922523 [info ] [MainThread]: 
[0m14:23:26.923718 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:23:26.923975 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:23:26.924201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:23:26.924367 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:23:26.927757 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:23:26.928221 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:23:26.947714 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:23:26.948249 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:26.948417 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:23:26.948564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:23:26.953119 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:23:26.953283 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:26.953636 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        capacity_c as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:23:26.955412 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "capacity" does not exist
LINE 43:         capacity,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".

[0m14:23:26.955559 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:23:26.955850 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:23:26.957859 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:26.958607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f53e2f15-0353-47d8-9363-6c0fd3c09400', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c23470>]}
[0m14:23:26.958908 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:23:26.959195 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:23:26.960052 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.960195 [debug] [MainThread]: On master: BEGIN
[0m14:23:26.960307 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:23:26.964354 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:23:26.964508 [debug] [MainThread]: On master: COMMIT
[0m14:23:26.964851 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:26.965016 [debug] [MainThread]: On master: COMMIT
[0m14:23:26.965249 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:26.965397 [debug] [MainThread]: On master: Close
[0m14:23:26.965560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:23:26.965669 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:23:26.965789 [info ] [MainThread]: 
[0m14:23:26.965921 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:23:26.966206 [debug] [MainThread]: Command end result
[0m14:23:26.980256 [info ] [MainThread]: 
[0m14:23:26.980524 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:23:26.980661 [info ] [MainThread]: 
[0m14:23:26.980834 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:26.980961 [info ] [MainThread]: 
[0m14:23:26.981098 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:23:26.981914 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5028126, "process_user_time": 0.952603, "process_kernel_time": 0.111443, "process_mem_max_rss": "122961920", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:23:26.982190 [debug] [MainThread]: Command `dbt run` failed at 14:23:26.982149 after 0.50 seconds
[0m14:23:26.982373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bea300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10473c860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4bf80>]}
[0m14:23:26.982533 [debug] [MainThread]: Flushing usage events
[0m14:23:51.017857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d9fda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495a0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104959e80>]}


============================== 14:23:51.020366 | a80bf338-4118-480d-a330-78d8199ee8af ==============================
[0m14:23:51.020366 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:23:51.020683 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:23:51.113739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10444aff0>]}
[0m14:23:51.136843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046b05f0>]}
[0m14:23:51.137307 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:23:51.147297 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:23:51.204031 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:23:51.204456 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:23:51.305298 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:23:51.311161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10554bd70>]}
[0m14:23:51.356385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b39b0>]}
[0m14:23:51.356690 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:23:51.356858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10541f8f0>]}
[0m14:23:51.357677 [info ] [MainThread]: 
[0m14:23:51.357984 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:23:51.358401 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:23:51.385235 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:23:51.385499 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:23:51.385656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:51.398809 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.013 seconds
[0m14:23:51.399629 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:23:51.401673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:23:51.404576 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:51.404746 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:23:51.404874 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:51.412103 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:23:51.412283 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:23:51.412433 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:23:51.420837 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:23:51.421496 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:23:51.421779 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:23:51.424189 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.424349 [debug] [MainThread]: On master: BEGIN
[0m14:23:51.424476 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:23:51.429662 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:23:51.429802 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.429985 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:23:51.438225 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m14:23:51.438850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b2a50>]}
[0m14:23:51.439059 [debug] [MainThread]: On master: ROLLBACK
[0m14:23:51.439308 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.439438 [debug] [MainThread]: On master: BEGIN
[0m14:23:51.439818 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:23:51.439960 [debug] [MainThread]: On master: COMMIT
[0m14:23:51.440082 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.440201 [debug] [MainThread]: On master: COMMIT
[0m14:23:51.440408 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:51.440536 [debug] [MainThread]: On master: Close
[0m14:23:51.440730 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:23:51.440879 [info ] [MainThread]: 
[0m14:23:51.441956 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:23:51.442225 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:23:51.442450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:23:51.442619 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:23:51.446262 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:23:51.447017 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:23:51.466566 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:23:51.467094 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:51.467260 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:23:51.467407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:23:51.471643 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:23:51.471810 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:23:51.472137 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        0 as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:23:51.473746 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "capacity" does not exist
LINE 43:         capacity,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".

[0m14:23:51.473928 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:23:51.474253 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:23:51.476299 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:51.477017 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a80bf338-4118-480d-a330-78d8199ee8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105994bf0>]}
[0m14:23:51.477309 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:23:51.477596 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:23:51.478455 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.478624 [debug] [MainThread]: On master: BEGIN
[0m14:23:51.478753 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:23:51.482266 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:23:51.482415 [debug] [MainThread]: On master: COMMIT
[0m14:23:51.482555 [debug] [MainThread]: Using postgres connection "master"
[0m14:23:51.482666 [debug] [MainThread]: On master: COMMIT
[0m14:23:51.482863 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:23:51.482976 [debug] [MainThread]: On master: Close
[0m14:23:51.483130 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:23:51.483240 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:23:51.483364 [info ] [MainThread]: 
[0m14:23:51.483500 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:23:51.483834 [debug] [MainThread]: Command end result
[0m14:23:51.497667 [info ] [MainThread]: 
[0m14:23:51.497984 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:23:51.498138 [info ] [MainThread]: 
[0m14:23:51.498360 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:23:51.498507 [info ] [MainThread]: 
[0m14:23:51.498673 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:23:51.499589 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.51118386, "process_user_time": 0.957449, "process_kernel_time": 0.12082, "process_mem_max_rss": "122732544", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:23:51.499906 [debug] [MainThread]: Command `dbt run` failed at 14:23:51.499863 after 0.51 seconds
[0m14:23:51.500140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e1ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495a030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104959cd0>]}
[0m14:23:51.500450 [debug] [MainThread]: Flushing usage events
[0m14:24:14.992489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e50a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d093a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4e090>]}


============================== 14:24:14.994734 | a6ee6727-82a4-4bb1-8f88-42358ebd05cb ==============================
[0m14:24:14.994734 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:24:14.995040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:24:15.087287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075363f0>]}
[0m14:24:15.109736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e299d0>]}
[0m14:24:15.110135 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:24:15.120726 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:24:15.177442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:24:15.177859 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:24:15.276568 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:24:15.282451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109209cd0>]}
[0m14:24:15.326980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096ab9b0>]}
[0m14:24:15.327283 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:24:15.327454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109732600>]}
[0m14:24:15.328240 [info ] [MainThread]: 
[0m14:24:15.328536 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:24:15.328979 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:24:15.355031 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:24:15.355287 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:24:15.355441 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:15.367618 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:24:15.368509 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:24:15.370833 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:24:15.374261 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:24:15.374510 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:24:15.374652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:24:15.378677 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:24:15.378913 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:24:15.379077 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:24:15.386955 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:24:15.387818 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:24:15.388156 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:24:15.390831 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.390994 [debug] [MainThread]: On master: BEGIN
[0m14:24:15.391125 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:24:15.395888 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:24:15.396049 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.396231 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:24:15.406791 [debug] [MainThread]: SQL status: SELECT 4 in 0.010 seconds
[0m14:24:15.407449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cf8410>]}
[0m14:24:15.407687 [debug] [MainThread]: On master: ROLLBACK
[0m14:24:15.407975 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.408109 [debug] [MainThread]: On master: BEGIN
[0m14:24:15.408538 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:24:15.408667 [debug] [MainThread]: On master: COMMIT
[0m14:24:15.408781 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.408892 [debug] [MainThread]: On master: COMMIT
[0m14:24:15.409110 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:24:15.409236 [debug] [MainThread]: On master: Close
[0m14:24:15.409430 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:24:15.409574 [info ] [MainThread]: 
[0m14:24:15.410622 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:24:15.410874 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:24:15.411083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:24:15.411247 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:24:15.414822 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:24:15.415274 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:24:15.435078 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:24:15.435692 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:24:15.435873 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:24:15.436031 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:15.440387 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:24:15.440566 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:24:15.440905 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:24:15.442467 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "capacity" does not exist
LINE 43:         capacity,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".

[0m14:24:15.442625 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:24:15.442934 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:24:15.445076 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:24:15.445825 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6ee6727-82a4-4bb1-8f88-42358ebd05cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109988230>]}
[0m14:24:15.446120 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:24:15.446408 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:24:15.447260 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.447396 [debug] [MainThread]: On master: BEGIN
[0m14:24:15.447534 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:24:15.453349 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:24:15.453509 [debug] [MainThread]: On master: COMMIT
[0m14:24:15.453628 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:15.453741 [debug] [MainThread]: On master: COMMIT
[0m14:24:15.453994 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:24:15.454121 [debug] [MainThread]: On master: Close
[0m14:24:15.454297 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:15.454414 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:24:15.454549 [info ] [MainThread]: 
[0m14:24:15.454690 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:24:15.454992 [debug] [MainThread]: Command end result
[0m14:24:15.468784 [info ] [MainThread]: 
[0m14:24:15.469082 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:24:15.469229 [info ] [MainThread]: 
[0m14:24:15.469426 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:24:15.469563 [info ] [MainThread]: 
[0m14:24:15.469710 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:24:15.470648 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5077688, "process_user_time": 0.951797, "process_kernel_time": 0.12017, "process_mem_max_rss": "124715008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:24:15.470950 [debug] [MainThread]: Command `dbt run` failed at 14:24:15.470904 after 0.51 seconds
[0m14:24:15.471162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4e3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4e420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d4e450>]}
[0m14:24:15.471464 [debug] [MainThread]: Flushing usage events
[0m14:24:41.752621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff3dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10711e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10711e060>]}


============================== 14:24:41.754879 | f18a47a3-8158-4fe7-b51e-6f1c6986e120 ==============================
[0m14:24:41.754879 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:24:41.755188 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run -m +leads', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:24:41.849320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053921b0>]}
[0m14:24:41.872272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057494c0>]}
[0m14:24:41.872704 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:24:41.882130 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:24:41.938711 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:24:41.938962 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:24:41.941460 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:24:41.959642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107697c80>]}
[0m14:24:42.005807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de2420>]}
[0m14:24:42.006127 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:24:42.006295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107696720>]}
[0m14:24:42.007258 [info ] [MainThread]: 
[0m14:24:42.007551 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:24:42.007958 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:24:42.032012 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:24:42.032280 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:24:42.032436 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:42.045499 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.013 seconds
[0m14:24:42.046259 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:24:42.048339 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:24:42.051309 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:24:42.051480 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:24:42.051614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:24:42.056663 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:24:42.056815 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:24:42.056961 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:24:42.063466 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.006 seconds
[0m14:24:42.064133 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:24:42.064427 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:24:42.066941 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.067121 [debug] [MainThread]: On master: BEGIN
[0m14:24:42.067255 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:24:42.077697 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m14:24:42.077855 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.078051 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:24:42.086743 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:24:42.087418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e48fe0>]}
[0m14:24:42.087638 [debug] [MainThread]: On master: ROLLBACK
[0m14:24:42.087917 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.088050 [debug] [MainThread]: On master: BEGIN
[0m14:24:42.088460 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:24:42.088596 [debug] [MainThread]: On master: COMMIT
[0m14:24:42.088715 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.088835 [debug] [MainThread]: On master: COMMIT
[0m14:24:42.089083 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:24:42.089220 [debug] [MainThread]: On master: Close
[0m14:24:42.089427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:24:42.089578 [info ] [MainThread]: 
[0m14:24:42.090797 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:24:42.091044 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:24:42.091252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:24:42.091425 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:24:42.095075 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:24:42.095553 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:24:42.116175 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:24:42.116684 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:24:42.116860 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:24:42.117010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:42.120721 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:24:42.120904 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:24:42.121238 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined
)

select * from final
  );
  
[0m14:24:42.122286 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "capacity" does not exist
LINE 43:         capacity,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".

[0m14:24:42.122443 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:24:42.122690 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:24:42.124822 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:24:42.125606 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f18a47a3-8158-4fe7-b51e-6f1c6986e120', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064c17c0>]}
[0m14:24:42.125922 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:24:42.126222 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:24:42.127082 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.127264 [debug] [MainThread]: On master: BEGIN
[0m14:24:42.127396 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:24:42.133017 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:24:42.133216 [debug] [MainThread]: On master: COMMIT
[0m14:24:42.133342 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:42.133463 [debug] [MainThread]: On master: COMMIT
[0m14:24:42.133740 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:24:42.133929 [debug] [MainThread]: On master: Close
[0m14:24:42.134165 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:42.134298 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:24:42.134447 [info ] [MainThread]: 
[0m14:24:42.134600 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:24:42.134916 [debug] [MainThread]: Command end result
[0m14:24:42.147698 [info ] [MainThread]: 
[0m14:24:42.147967 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:24:42.148115 [info ] [MainThread]: 
[0m14:24:42.148293 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:24:42.148427 [info ] [MainThread]: 
[0m14:24:42.148564 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:24:42.149363 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.4267706, "process_user_time": 0.872846, "process_kernel_time": 0.109806, "process_mem_max_rss": "118947840", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:24:42.149635 [debug] [MainThread]: Command `dbt run` failed at 14:24:42.149594 after 0.43 seconds
[0m14:24:42.149821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107662600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068d0230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076fba10>]}
[0m14:24:42.149975 [debug] [MainThread]: Flushing usage events
[0m14:26:06.837723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095716d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10971e390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10971e0c0>]}


============================== 14:26:06.840212 | 704813b3-dab9-4f7d-9dd3-f94352750864 ==============================
[0m14:26:06.840212 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:26:06.840564 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m salesforce_leads', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:26:06.934052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b3d730>]}
[0m14:26:06.956885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10971e0c0>]}
[0m14:26:06.957356 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:26:06.967642 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:26:07.025323 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:26:07.025801 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:26:07.126197 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:26:07.132074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a40d250>]}
[0m14:26:07.177359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a257ce0>]}
[0m14:26:07.177664 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:26:07.177829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4d9910>]}
[0m14:26:07.178651 [info ] [MainThread]: 
[0m14:26:07.178946 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:26:07.179375 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:26:07.205187 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:26:07.205457 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:26:07.205603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:26:07.217244 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:26:07.217973 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:26:07.219970 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:26:07.222823 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:07.222985 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:26:07.223130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:07.228922 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:26:07.229083 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:07.229228 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:26:07.236956 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:26:07.237630 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:26:07.237975 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:26:07.240400 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.240566 [debug] [MainThread]: On master: BEGIN
[0m14:26:07.240699 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:26:07.246942 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:26:07.247106 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.247304 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:26:07.258249 [debug] [MainThread]: SQL status: SELECT 4 in 0.011 seconds
[0m14:26:07.258936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3d9280>]}
[0m14:26:07.259159 [debug] [MainThread]: On master: ROLLBACK
[0m14:26:07.259431 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.259563 [debug] [MainThread]: On master: BEGIN
[0m14:26:07.259975 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:26:07.260110 [debug] [MainThread]: On master: COMMIT
[0m14:26:07.260232 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.260349 [debug] [MainThread]: On master: COMMIT
[0m14:26:07.260571 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:07.260697 [debug] [MainThread]: On master: Close
[0m14:26:07.260898 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:26:07.261049 [info ] [MainThread]: 
[0m14:26:07.262252 [debug] [Thread-1 (]: Began running node model.brightwheel.salesforce_leads
[0m14:26:07.262503 [info ] [Thread-1 (]: 1 of 1 START sql view model brightwheel_exam.salesforce_leads .................. [RUN]
[0m14:26:07.262710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.salesforce_leads)
[0m14:26:07.262883 [debug] [Thread-1 (]: Began compiling node model.brightwheel.salesforce_leads
[0m14:26:07.267314 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.salesforce_leads"
[0m14:26:07.268046 [debug] [Thread-1 (]: Began executing node model.brightwheel.salesforce_leads
[0m14:26:07.285974 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.salesforce_leads"
[0m14:26:07.286509 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.286679 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: BEGIN
[0m14:26:07.286823 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:07.293079 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m14:26:07.293245 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.293420 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */

  create view "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/salesforce_leads

with source as (

    select * from "brightwheel"."public"."salesforce_leads"

),

clean as (
    select
        id,
        is_deleted,
        last_name,
        first_name,
        title,
        company,
        street,
        city,
        state,
        postal_code,
        country,
        phone,
        mobile_phone,
        email,
        website,
        lead_source,
        status,
        is_converted,
        created_date,
        last_modified_date,
        last_activity_date,
        last_viewed_date,
        last_referenced_date,
        email_bounced_reason,
        email_bounced_date,
        outreach_stage_c as outreach_stage,
        current_enrollment_c as current_enrollment,
        capacity_c as capacity,
        lead_source_last_updated_c as lead_source_last_updated,
        brightwheel_school_uuid_c as brightwheel_school_uuid

    from source

)

select * from clean
  );
[0m14:26:07.301435 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m14:26:07.304683 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.304881 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
alter table "brightwheel"."brightwheel_exam"."salesforce_leads" rename to "salesforce_leads__dbt_backup"
[0m14:26:07.305991 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:07.307394 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.307561 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
alter table "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp" rename to "salesforce_leads"
[0m14:26:07.308562 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:26:07.316741 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m14:26:07.316953 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.317106 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m14:26:07.317910 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:26:07.320887 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup"
[0m14:26:07.323153 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:26:07.323342 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
drop view if exists "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup" cascade
[0m14:26:07.325819 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:26:07.326927 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: Close
[0m14:26:07.327603 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '704813b3-dab9-4f7d-9dd3-f94352750864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078dd0d0>]}
[0m14:26:07.327891 [info ] [Thread-1 (]: 1 of 1 OK created sql view model brightwheel_exam.salesforce_leads ............. [[32mCREATE VIEW[0m in 0.06s]
[0m14:26:07.328177 [debug] [Thread-1 (]: Finished running node model.brightwheel.salesforce_leads
[0m14:26:07.328760 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.328938 [debug] [MainThread]: On master: BEGIN
[0m14:26:07.329075 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:26:07.334039 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:26:07.334197 [debug] [MainThread]: On master: COMMIT
[0m14:26:07.334319 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:07.334435 [debug] [MainThread]: On master: COMMIT
[0m14:26:07.334684 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:07.334828 [debug] [MainThread]: On master: Close
[0m14:26:07.335041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:26:07.335161 [debug] [MainThread]: Connection 'model.brightwheel.salesforce_leads' was properly closed.
[0m14:26:07.335294 [info ] [MainThread]: 
[0m14:26:07.335448 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m14:26:07.335739 [debug] [MainThread]: Command end result
[0m14:26:07.349119 [info ] [MainThread]: 
[0m14:26:07.349378 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:26:07.349528 [info ] [MainThread]: 
[0m14:26:07.349679 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:26:07.350490 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.54327774, "process_user_time": 0.974248, "process_kernel_time": 0.123065, "process_mem_max_rss": "124157952", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:26:07.350758 [debug] [MainThread]: Command `dbt run` succeeded at 14:26:07.350715 after 0.54 seconds
[0m14:26:07.350942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10971e390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109094380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095b2420>]}
[0m14:26:07.351099 [debug] [MainThread]: Flushing usage events
[0m14:26:14.925285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067c3bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080d6090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837e090>]}


============================== 14:26:14.927765 | 07cc8351-b609-412c-a7d2-23191ad18911 ==============================
[0m14:26:14.927765 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:26:14.928108 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:26:15.020600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10791d070>]}
[0m14:26:15.043165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083a4830>]}
[0m14:26:15.043704 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:26:15.053981 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:26:15.110565 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:26:15.110871 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:26:15.113383 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:26:15.131910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108833fe0>]}
[0m14:26:15.177759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088cf500>]}
[0m14:26:15.178065 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:26:15.178234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b3320>]}
[0m14:26:15.179064 [info ] [MainThread]: 
[0m14:26:15.179376 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:26:15.179795 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:26:15.203950 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:26:15.204224 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:26:15.204371 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:26:15.218001 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.014 seconds
[0m14:26:15.218758 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:26:15.220815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:26:15.223763 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:15.223929 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:26:15.224057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:15.231396 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:26:15.231562 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:15.231711 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:26:15.237272 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m14:26:15.237912 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:26:15.238185 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:26:15.240696 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.240862 [debug] [MainThread]: On master: BEGIN
[0m14:26:15.240984 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:26:15.245901 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:26:15.246065 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.246255 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:26:15.254444 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m14:26:15.255122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088ccef0>]}
[0m14:26:15.255352 [debug] [MainThread]: On master: ROLLBACK
[0m14:26:15.255619 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.255750 [debug] [MainThread]: On master: BEGIN
[0m14:26:15.256132 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:26:15.256270 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.256393 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.256512 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.256742 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:15.256880 [debug] [MainThread]: On master: Close
[0m14:26:15.257087 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:26:15.257244 [info ] [MainThread]: 
[0m14:26:15.258506 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:26:15.258789 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:26:15.259024 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:26:15.259193 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:26:15.262804 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:26:15.263376 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:26:15.282609 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:26:15.283061 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:26:15.283223 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:26:15.283363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:15.287907 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:26:15.288112 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:26:15.288443 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:26:15.289470 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "capacity" does not exist
LINE 43:         capacity,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".

[0m14:26:15.289618 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:26:15.289850 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:26:15.291901 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:26:15.292613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07cc8351-b609-412c-a7d2-23191ad18911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10791d9a0>]}
[0m14:26:15.292907 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:26:15.293209 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:26:15.294208 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.294386 [debug] [MainThread]: On master: BEGIN
[0m14:26:15.294515 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:26:15.300850 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:26:15.301033 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.301156 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:15.301272 [debug] [MainThread]: On master: COMMIT
[0m14:26:15.301566 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:15.301819 [debug] [MainThread]: On master: Close
[0m14:26:15.302057 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:26:15.302191 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:26:15.302344 [info ] [MainThread]: 
[0m14:26:15.302502 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:26:15.302874 [debug] [MainThread]: Command end result
[0m14:26:15.315304 [info ] [MainThread]: 
[0m14:26:15.315573 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:26:15.315716 [info ] [MainThread]: 
[0m14:26:15.315898 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "capacity" does not exist
  LINE 43:         capacity,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.capacity_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:26:15.316036 [info ] [MainThread]: 
[0m14:26:15.316172 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:26:15.316957 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.42190343, "process_user_time": 0.859588, "process_kernel_time": 0.106552, "process_mem_max_rss": "119013376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:26:15.317228 [debug] [MainThread]: Command `dbt run` failed at 14:26:15.317186 after 0.42 seconds
[0m14:26:15.317414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108480c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084835f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108864e60>]}
[0m14:26:15.317570 [debug] [MainThread]: Flushing usage events
[0m14:26:36.633373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10514e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10891e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10891e2d0>]}


============================== 14:26:36.635816 | 18bff516-7ff5-4936-bcaf-c6e65c667c11 ==============================
[0m14:26:36.635816 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:26:36.636131 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:26:36.729935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089c5310>]}
[0m14:26:36.752829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a88b30>]}
[0m14:26:36.753434 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:26:36.763780 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:26:36.823583 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:26:36.824028 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:26:36.933409 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.1_intermediate
- models.brightwheel.3_activation
[0m14:26:36.939430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e50cb0>]}
[0m14:26:36.987592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10945c380>]}
[0m14:26:36.987884 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:26:36.988047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e53290>]}
[0m14:26:36.988842 [info ] [MainThread]: 
[0m14:26:36.989132 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:26:36.989621 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:26:37.016113 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:26:37.016390 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:26:37.016545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:26:37.028578 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:26:37.029393 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:26:37.031427 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:26:37.034340 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:37.034508 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:26:37.034635 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:26:37.038660 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:26:37.038816 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:26:37.038960 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:26:37.043047 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.004 seconds
[0m14:26:37.043649 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:26:37.043946 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:26:37.046391 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.046558 [debug] [MainThread]: On master: BEGIN
[0m14:26:37.046683 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:26:37.050450 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:26:37.050595 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.050774 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:26:37.057053 [debug] [MainThread]: SQL status: SELECT 4 in 0.006 seconds
[0m14:26:37.057704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089f99d0>]}
[0m14:26:37.057919 [debug] [MainThread]: On master: ROLLBACK
[0m14:26:37.058181 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.058305 [debug] [MainThread]: On master: BEGIN
[0m14:26:37.058670 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:26:37.058801 [debug] [MainThread]: On master: COMMIT
[0m14:26:37.058917 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.059028 [debug] [MainThread]: On master: COMMIT
[0m14:26:37.059239 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:37.059362 [debug] [MainThread]: On master: Close
[0m14:26:37.059543 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:26:37.059687 [info ] [MainThread]: 
[0m14:26:37.060704 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:26:37.060942 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:26:37.061141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:26:37.061299 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:26:37.064618 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:26:37.065030 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:26:37.084260 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:26:37.084856 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:26:37.085023 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:26:37.085170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:26:37.089211 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:26:37.089372 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:26:37.089698 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from salesforce_leads

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity_c as capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:26:37.090868 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "brightwheel_school_uuid" does not exist
LINE 60:         brightwheel_school_uuid as provider_id,
                 ^
HINT:  Perhaps you meant to reference the column "salesforce_leads.brightwheel_school_uuid_c".

[0m14:26:37.091021 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:26:37.091291 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:26:37.093392 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "brightwheel_school_uuid" does not exist
  LINE 60:         brightwheel_school_uuid as provider_id,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.brightwheel_school_uuid_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:26:37.094118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18bff516-7ff5-4936-bcaf-c6e65c667c11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af40da0>]}
[0m14:26:37.094410 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:26:37.094699 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:26:37.095554 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.095694 [debug] [MainThread]: On master: BEGIN
[0m14:26:37.095806 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:26:37.099551 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:26:37.099692 [debug] [MainThread]: On master: COMMIT
[0m14:26:37.099803 [debug] [MainThread]: Using postgres connection "master"
[0m14:26:37.099910 [debug] [MainThread]: On master: COMMIT
[0m14:26:37.100104 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:26:37.100246 [debug] [MainThread]: On master: Close
[0m14:26:37.100397 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:26:37.100505 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:26:37.100623 [info ] [MainThread]: 
[0m14:26:37.100757 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.11 seconds (0.11s).
[0m14:26:37.101055 [debug] [MainThread]: Command end result
[0m14:26:37.115050 [info ] [MainThread]: 
[0m14:26:37.115306 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:26:37.115443 [info ] [MainThread]: 
[0m14:26:37.115612 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "brightwheel_school_uuid" does not exist
  LINE 60:         brightwheel_school_uuid as provider_id,
                   ^
  HINT:  Perhaps you meant to reference the column "salesforce_leads.brightwheel_school_uuid_c".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:26:37.115742 [info ] [MainThread]: 
[0m14:26:37.115872 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:26:37.116661 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5132841, "process_user_time": 0.965644, "process_kernel_time": 0.121796, "process_mem_max_rss": "124649472", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:26:37.116960 [debug] [MainThread]: Command `dbt run` failed at 14:26:37.116919 after 0.51 seconds
[0m14:26:37.117146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10891e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10826bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10765f740>]}
[0m14:26:37.117299 [debug] [MainThread]: Flushing usage events
[0m14:27:11.328968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108185790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10846a3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10846a0f0>]}


============================== 14:27:11.331331 | 04ed6a93-c45d-4df0-8f78-c986d219ab48 ==============================
[0m14:27:11.331331 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:27:11.331653 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:27:11.423954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108570b60>]}
[0m14:27:11.446390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108496360>]}
[0m14:27:11.446807 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:27:11.456475 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:27:11.512626 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:27:11.513035 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:27:11.611508 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:27:11.617191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10905ff20>]}
[0m14:27:11.662614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e02180>]}
[0m14:27:11.662939 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:27:11.663111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a0d010>]}
[0m14:27:11.663909 [info ] [MainThread]: 
[0m14:27:11.664188 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:27:11.664627 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:27:11.690726 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:27:11.691011 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:27:11.691166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:11.710780 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.020 seconds
[0m14:27:11.711721 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:27:11.714048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:27:11.717140 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:27:11.717313 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:27:11.717441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:11.723668 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:27:11.723856 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:27:11.724007 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:27:11.730685 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:27:11.731333 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:27:11.731606 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:27:11.733987 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.734163 [debug] [MainThread]: On master: BEGIN
[0m14:27:11.734290 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:27:11.738575 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:27:11.738714 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.738902 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:27:11.747029 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m14:27:11.747628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108923260>]}
[0m14:27:11.747828 [debug] [MainThread]: On master: ROLLBACK
[0m14:27:11.748080 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.748201 [debug] [MainThread]: On master: BEGIN
[0m14:27:11.748571 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:27:11.748699 [debug] [MainThread]: On master: COMMIT
[0m14:27:11.748810 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.748921 [debug] [MainThread]: On master: COMMIT
[0m14:27:11.749126 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:27:11.749248 [debug] [MainThread]: On master: Close
[0m14:27:11.749435 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:27:11.749582 [info ] [MainThread]: 
[0m14:27:11.750628 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:27:11.750885 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:27:11.751086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:27:11.751255 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:27:11.755469 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:27:11.755927 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:27:11.775993 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:27:11.776561 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:27:11.776734 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:27:11.776877 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:27:11.780979 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:27:11.781167 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:27:11.781510 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:27:11.783953 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 80:         city,
                 ^
DETAIL:  There is a column named "city" in table "*SELECT* 1", but it cannot be referenced from this part of the query.

[0m14:27:11.784120 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:27:11.784440 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:27:11.786523 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "city" does not exist
  LINE 80:         city,
                   ^
  DETAIL:  There is a column named "city" in table "*SELECT* 1", but it cannot be referenced from this part of the query.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:27:11.787257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04ed6a93-c45d-4df0-8f78-c986d219ab48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094a23c0>]}
[0m14:27:11.787552 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:27:11.787834 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:27:11.788693 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.788845 [debug] [MainThread]: On master: BEGIN
[0m14:27:11.788964 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:27:11.792421 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m14:27:11.792564 [debug] [MainThread]: On master: COMMIT
[0m14:27:11.792677 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:11.792788 [debug] [MainThread]: On master: COMMIT
[0m14:27:11.792982 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:27:11.793099 [debug] [MainThread]: On master: Close
[0m14:27:11.793249 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:11.793360 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:27:11.793485 [info ] [MainThread]: 
[0m14:27:11.793621 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:27:11.793921 [debug] [MainThread]: Command end result
[0m14:27:11.808062 [info ] [MainThread]: 
[0m14:27:11.808369 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:27:11.808520 [info ] [MainThread]: 
[0m14:27:11.808709 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "city" does not exist
  LINE 80:         city,
                   ^
  DETAIL:  There is a column named "city" in table "*SELECT* 1", but it cannot be referenced from this part of the query.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:27:11.808854 [info ] [MainThread]: 
[0m14:27:11.809004 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:27:11.809908 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.51029396, "process_user_time": 0.953675, "process_kernel_time": 0.120958, "process_mem_max_rss": "122241024", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:27:11.810311 [debug] [MainThread]: Command `dbt run` failed at 14:27:11.810235 after 0.51 seconds
[0m14:27:11.810661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10846a0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10846a3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f1cbc0>]}
[0m14:27:11.810853 [debug] [MainThread]: Flushing usage events
[0m14:27:45.399065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f35370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f6540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f62a0>]}


============================== 14:27:45.401226 | 1a044e64-5650-4481-aa38-5ea36fc1fff9 ==============================
[0m14:27:45.401226 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:27:45.401545 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:27:45.495608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eae510>]}
[0m14:27:45.518201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105643ef0>]}
[0m14:27:45.518612 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:27:45.527506 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:27:45.584277 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:27:45.584664 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:27:45.682302 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:27:45.688005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075efec0>]}
[0m14:27:45.732968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073504d0>]}
[0m14:27:45.733273 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:27:45.733438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f4bce0>]}
[0m14:27:45.734252 [info ] [MainThread]: 
[0m14:27:45.734547 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:27:45.734992 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:27:45.761220 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:27:45.761514 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:27:45.761666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:45.773459 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:27:45.774486 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:27:45.776813 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:27:45.780144 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:27:45.780388 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:27:45.780526 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:45.785115 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:27:45.785338 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:27:45.785490 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:27:45.792544 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:27:45.793316 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:27:45.793656 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:27:45.796248 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.796416 [debug] [MainThread]: On master: BEGIN
[0m14:27:45.796540 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:27:45.801005 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:27:45.801149 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.801330 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:27:45.811949 [debug] [MainThread]: SQL status: SELECT 4 in 0.010 seconds
[0m14:27:45.812585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105245910>]}
[0m14:27:45.812800 [debug] [MainThread]: On master: ROLLBACK
[0m14:27:45.813046 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.813174 [debug] [MainThread]: On master: BEGIN
[0m14:27:45.813555 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:27:45.813692 [debug] [MainThread]: On master: COMMIT
[0m14:27:45.813812 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.813932 [debug] [MainThread]: On master: COMMIT
[0m14:27:45.814150 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:27:45.814283 [debug] [MainThread]: On master: Close
[0m14:27:45.814494 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:27:45.814646 [info ] [MainThread]: 
[0m14:27:45.815905 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:27:45.816174 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:27:45.816406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:27:45.816582 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:27:45.820962 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:27:45.821411 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:27:45.840832 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:27:45.841376 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:27:45.841538 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:27:45.841679 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:27:45.847042 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:27:45.847205 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:27:45.847546 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,

        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:27:45.850350 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "zip" does not exist
LINE 101:         zip as zip,
                  ^
DETAIL:  There is a column named "zip" in table "*SELECT* 1", but it cannot be referenced from this part of the query.

[0m14:27:45.850504 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:27:45.850829 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:27:45.852955 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "zip" does not exist
  LINE 101:         zip as zip,
                    ^
  DETAIL:  There is a column named "zip" in table "*SELECT* 1", but it cannot be referenced from this part of the query.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:27:45.853715 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a044e64-5650-4481-aa38-5ea36fc1fff9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10750b5f0>]}
[0m14:27:45.854018 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:27:45.854308 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:27:45.855198 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.855367 [debug] [MainThread]: On master: BEGIN
[0m14:27:45.855495 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:27:45.859028 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:27:45.859179 [debug] [MainThread]: On master: COMMIT
[0m14:27:45.859295 [debug] [MainThread]: Using postgres connection "master"
[0m14:27:45.859408 [debug] [MainThread]: On master: COMMIT
[0m14:27:45.859653 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:27:45.859769 [debug] [MainThread]: On master: Close
[0m14:27:45.859925 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:45.860036 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:27:45.860158 [info ] [MainThread]: 
[0m14:27:45.860297 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:27:45.860642 [debug] [MainThread]: Command end result
[0m14:27:45.874942 [info ] [MainThread]: 
[0m14:27:45.875207 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:27:45.875345 [info ] [MainThread]: 
[0m14:27:45.875523 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "zip" does not exist
  LINE 101:         zip as zip,
                    ^
  DETAIL:  There is a column named "zip" in table "*SELECT* 1", but it cannot be referenced from this part of the query.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:27:45.875653 [info ] [MainThread]: 
[0m14:27:45.875789 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:27:45.876601 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5072819, "process_user_time": 0.955361, "process_kernel_time": 0.120366, "process_mem_max_rss": "122634240", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:27:45.876889 [debug] [MainThread]: Command `dbt run` failed at 14:27:45.876846 after 0.51 seconds
[0m14:27:45.877077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10579f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10646c560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10644bc50>]}
[0m14:27:45.877236 [debug] [MainThread]: Flushing usage events
[0m14:28:05.437499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106327320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108206420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108206150>]}


============================== 14:28:05.439750 | 3b2f14b9-2bba-4077-86f2-41196f7b3709 ==============================
[0m14:28:05.439750 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:28:05.440054 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:28:05.534742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082ea930>]}
[0m14:28:05.557395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074fcc20>]}
[0m14:28:05.557824 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:28:05.567000 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:28:05.623260 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:28:05.623730 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:28:05.721886 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:28:05.727574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dfbf20>]}
[0m14:28:05.772613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b9e5d0>]}
[0m14:28:05.772934 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:28:05.773102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108205be0>]}
[0m14:28:05.773921 [info ] [MainThread]: 
[0m14:28:05.774225 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:28:05.774656 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:28:05.800786 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:28:05.801059 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:28:05.801209 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:05.812736 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m14:28:05.813615 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:28:05.815900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:28:05.818877 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:28:05.819051 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:28:05.819183 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:28:05.825652 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:28:05.825933 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:28:05.826103 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:28:05.833032 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:28:05.833806 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:28:05.834138 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:28:05.836686 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.836857 [debug] [MainThread]: On master: BEGIN
[0m14:28:05.836983 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:28:05.841755 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:28:05.841899 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.842075 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:28:05.850944 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:28:05.851581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10906be90>]}
[0m14:28:05.851764 [debug] [MainThread]: On master: ROLLBACK
[0m14:28:05.852100 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.852216 [debug] [MainThread]: On master: BEGIN
[0m14:28:05.852662 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:28:05.852797 [debug] [MainThread]: On master: COMMIT
[0m14:28:05.852904 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.853009 [debug] [MainThread]: On master: COMMIT
[0m14:28:05.853264 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:28:05.853380 [debug] [MainThread]: On master: Close
[0m14:28:05.853606 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:05.853747 [info ] [MainThread]: 
[0m14:28:05.854803 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:28:05.855128 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:28:05.855344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:28:05.855499 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:28:05.860026 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:28:05.860495 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:28:05.880398 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:28:05.880998 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:28:05.881183 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:28:05.881351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:28:05.888295 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m14:28:05.888514 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:28:05.888900 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:28:05.892530 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "ages_accepted_4" does not exist
LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                           ^
HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".

[0m14:28:05.892707 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:28:05.893090 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:28:05.895274 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "ages_accepted_4" does not exist
  LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                             ^
  HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:28:05.896038 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b2f14b9-2bba-4077-86f2-41196f7b3709', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10923d5b0>]}
[0m14:28:05.896343 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:28:05.896646 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:28:05.897583 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.897750 [debug] [MainThread]: On master: BEGIN
[0m14:28:05.897880 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:28:05.905131 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:28:05.905333 [debug] [MainThread]: On master: COMMIT
[0m14:28:05.905457 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:05.905572 [debug] [MainThread]: On master: COMMIT
[0m14:28:05.905881 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:28:05.906139 [debug] [MainThread]: On master: Close
[0m14:28:05.906431 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:05.906580 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:28:05.906733 [info ] [MainThread]: 
[0m14:28:05.906890 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:28:05.907213 [debug] [MainThread]: Command end result
[0m14:28:05.921024 [info ] [MainThread]: 
[0m14:28:05.921308 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:28:05.921501 [info ] [MainThread]: 
[0m14:28:05.921730 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "ages_accepted_4" does not exist
  LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                             ^
  HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:28:05.921876 [info ] [MainThread]: 
[0m14:28:05.922013 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:28:05.922821 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.51397955, "process_user_time": 0.952736, "process_kernel_time": 0.117852, "process_mem_max_rss": "123027456", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:28:05.923085 [debug] [MainThread]: Command `dbt run` failed at 14:28:05.923045 after 0.51 seconds
[0m14:28:05.923268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c9c890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108206330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082063c0>]}
[0m14:28:05.923426 [debug] [MainThread]: Flushing usage events
[0m14:28:23.181684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086e6c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089ce1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089cdf10>]}


============================== 14:28:23.184179 | b64cd4d1-4170-4af0-a359-ec4c11100c2e ==============================
[0m14:28:23.184179 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:28:23.184501 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m +leads', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:28:23.275880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10791e7e0>]}
[0m14:28:23.298723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087200e0>]}
[0m14:28:23.299176 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:28:23.309600 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:28:23.365786 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:28:23.366052 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:28:23.368670 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:28:23.387393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108acca70>]}
[0m14:28:23.432794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095e2600>]}
[0m14:28:23.433075 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:28:23.433243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108eb5640>]}
[0m14:28:23.434294 [info ] [MainThread]: 
[0m14:28:23.434599 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:28:23.436215 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:28:23.459892 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:28:23.460182 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:28:23.460331 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:28:23.472447 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:28:23.473214 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:28:23.473963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:28:23.476932 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:28:23.477107 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:28:23.477261 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:28:23.483277 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:28:23.483431 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:28:23.483576 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:28:23.490742 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:28:23.491350 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:28:23.491651 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:28:23.494120 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.494298 [debug] [MainThread]: On master: BEGIN
[0m14:28:23.494424 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:28:23.500245 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:28:23.500416 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.500608 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:28:23.509452 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:28:23.510173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095ae540>]}
[0m14:28:23.510409 [debug] [MainThread]: On master: ROLLBACK
[0m14:28:23.510687 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.510815 [debug] [MainThread]: On master: BEGIN
[0m14:28:23.511238 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:28:23.511373 [debug] [MainThread]: On master: COMMIT
[0m14:28:23.511492 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.511609 [debug] [MainThread]: On master: COMMIT
[0m14:28:23.511847 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:28:23.511974 [debug] [MainThread]: On master: Close
[0m14:28:23.512171 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:28:23.512322 [info ] [MainThread]: 
[0m14:28:23.513586 [debug] [Thread-1 (]: Began running node model.brightwheel.salesforce_leads
[0m14:28:23.513876 [info ] [Thread-1 (]: 1 of 2 START sql view model brightwheel_exam.salesforce_leads .................. [RUN]
[0m14:28:23.514114 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.salesforce_leads)
[0m14:28:23.514295 [debug] [Thread-1 (]: Began compiling node model.brightwheel.salesforce_leads
[0m14:28:23.518420 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.salesforce_leads"
[0m14:28:23.518886 [debug] [Thread-1 (]: Began executing node model.brightwheel.salesforce_leads
[0m14:28:23.538613 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.salesforce_leads"
[0m14:28:23.539233 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.539408 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: BEGIN
[0m14:28:23.539560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:28:23.546723 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m14:28:23.546944 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.547133 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */

  create view "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp"
    
    
  as (
    -- model: staging/salesforce/salesforce_leads

with source as (

    select * from "brightwheel"."public"."salesforce_leads"

),

clean as (
    select
        id,
        is_deleted,
        last_name,
        first_name,
        title,
        company,
        street,
        city,
        state,
        postal_code,
        country,
        phone,
        mobile_phone,
        email,
        website,
        lead_source,
        status,
        is_converted,
        created_date,
        last_modified_date,
        last_activity_date,
        last_viewed_date,
        last_referenced_date,
        email_bounced_reason,
        email_bounced_date,
        outreach_stage_c as outreach_stage,
        current_enrollment_c as current_enrollment,
        capacity_c as capacity,
        lead_source_last_updated_c as lead_source_last_updated,
        brightwheel_school_uuid_c as brightwheel_school_uuid

    from source

)

select * from clean
  );
[0m14:28:23.552853 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m14:28:23.556480 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.556731 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
alter table "brightwheel"."brightwheel_exam"."salesforce_leads" rename to "salesforce_leads__dbt_backup"
[0m14:28:23.557853 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:28:23.559444 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.559630 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
alter table "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_tmp" rename to "salesforce_leads"
[0m14:28:23.560792 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:28:23.568746 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m14:28:23.568943 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.569111 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: COMMIT
[0m14:28:23.570329 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:28:23.573155 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup"
[0m14:28:23.575407 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.salesforce_leads"
[0m14:28:23.575577 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.salesforce_leads"} */
drop view if exists "brightwheel"."brightwheel_exam"."salesforce_leads__dbt_backup" cascade
[0m14:28:23.578220 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m14:28:23.579308 [debug] [Thread-1 (]: On model.brightwheel.salesforce_leads: Close
[0m14:28:23.579954 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f515b0>]}
[0m14:28:23.580251 [info ] [Thread-1 (]: 1 of 2 OK created sql view model brightwheel_exam.salesforce_leads ............. [[32mCREATE VIEW[0m in 0.07s]
[0m14:28:23.580535 [debug] [Thread-1 (]: Finished running node model.brightwheel.salesforce_leads
[0m14:28:23.580946 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:28:23.581206 [info ] [Thread-1 (]: 2 of 2 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:28:23.581449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.brightwheel.salesforce_leads, now model.brightwheel.leads)
[0m14:28:23.581608 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:28:23.583303 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:28:23.583683 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:28:23.594434 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:28:23.594957 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:28:23.595118 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:28:23.595258 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:28:23.601248 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m14:28:23.601436 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:28:23.601768 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from source1

),

source2 as (

    select * from source2

),

source3 as (

    select * from source3

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:28:23.606208 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "ages_accepted_4" does not exist
LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                           ^
HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".

[0m14:28:23.606370 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:28:23.606711 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:28:23.608824 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "ages_accepted_4" does not exist
  LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                             ^
  HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:28:23.609072 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b64cd4d1-4170-4af0-a359-ec4c11100c2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fea720>]}
[0m14:28:23.609381 [error] [Thread-1 (]: 2 of 2 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:28:23.609672 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:28:23.610355 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.610496 [debug] [MainThread]: On master: BEGIN
[0m14:28:23.610614 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:28:23.616932 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:28:23.617112 [debug] [MainThread]: On master: COMMIT
[0m14:28:23.617242 [debug] [MainThread]: Using postgres connection "master"
[0m14:28:23.617366 [debug] [MainThread]: On master: COMMIT
[0m14:28:23.617624 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:28:23.617762 [debug] [MainThread]: On master: Close
[0m14:28:23.617933 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:28:23.618048 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:28:23.618183 [info ] [MainThread]: 
[0m14:28:23.618325 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m14:28:23.618679 [debug] [MainThread]: Command end result
[0m14:28:23.632727 [info ] [MainThread]: 
[0m14:28:23.633013 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:28:23.633157 [info ] [MainThread]: 
[0m14:28:23.633333 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "ages_accepted_4" does not exist
  LINE 111:             when ages_accepted_4 = 'School-age (5 years-olde...
                             ^
  HINT:  Perhaps you meant to reference the column "source2.ages_accepted_1".
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:28:23.633474 [info ] [MainThread]: 
[0m14:28:23.633612 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m14:28:23.634411 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.48364946, "process_user_time": 0.910384, "process_kernel_time": 0.111017, "process_mem_max_rss": "120848384", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:28:23.634679 [debug] [MainThread]: Command `dbt run` failed at 14:28:23.634638 after 0.48 seconds
[0m14:28:23.634871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771fe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10876daf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089ce1b0>]}
[0m14:28:23.635033 [debug] [MainThread]: Flushing usage events
[0m14:29:18.129032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083885c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10921e450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10921e1b0>]}


============================== 14:29:18.131293 | 97c5be0e-0126-40f3-9d54-db186dd7f195 ==============================
[0m14:29:18.131293 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:29:18.131599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run -m +leads', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:29:18.224577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97c5be0e-0126-40f3-9d54-db186dd7f195', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107496270>]}
[0m14:29:18.247212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97c5be0e-0126-40f3-9d54-db186dd7f195', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091fc800>]}
[0m14:29:18.247620 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:29:18.256791 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:29:18.313204 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:29:18.313570 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:29:18.384064 [error] [MainThread]: Encountered an error:
Compilation Error in model leads (models/2_mart/leads.sql)
  unexpected '}', expected ')'
    line 21
      select * from {{ ref('source3' }}
[0m14:29:18.384989 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.28628963, "process_user_time": 0.792086, "process_kernel_time": 0.090096, "process_mem_max_rss": "107577344", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:29:18.385295 [debug] [MainThread]: Command `dbt run` failed at 14:29:18.385242 after 0.29 seconds
[0m14:29:18.385502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108358aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ea4ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097957f0>]}
[0m14:29:18.385682 [debug] [MainThread]: Flushing usage events
[0m14:29:22.954819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f0dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e23f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e2120>]}


============================== 14:29:22.957290 | 64324853-c5ee-4eb2-b873-b403b5ddc31c ==============================
[0m14:29:22.957290 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:29:22.957607 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:29:23.051444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64324853-c5ee-4eb2-b873-b403b5ddc31c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a56ff0>]}
[0m14:29:23.074122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64324853-c5ee-4eb2-b873-b403b5ddc31c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103845490>]}
[0m14:29:23.074552 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:29:23.084406 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:29:23.140703 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:29:23.141085 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:29:23.210568 [error] [MainThread]: Encountered an error:
Compilation Error in model leads (models/2_mart/leads.sql)
  unexpected '}', expected ')'
    line 21
      select * from {{ ref('source3' }}
[0m14:29:23.211623 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.2865132, "process_user_time": 0.795076, "process_kernel_time": 0.087338, "process_mem_max_rss": "106561536", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:29:23.211948 [debug] [MainThread]: Command `dbt run` failed at 14:29:23.211896 after 0.29 seconds
[0m14:29:23.212224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056e2390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106affa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10578ae40>]}
[0m14:29:23.212407 [debug] [MainThread]: Flushing usage events
[0m14:29:28.257153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103755e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103776e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106e2030>]}


============================== 14:29:28.259196 | ac5e047f-701c-4168-b508-b34f4ae70945 ==============================
[0m14:29:28.259196 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:29:28.259506 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:29:28.352955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110789100>]}
[0m14:29:28.375364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e91340>]}
[0m14:29:28.375769 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:29:28.385277 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:29:28.441309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:29:28.441818 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:29:28.539788 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:29:28.545566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114f8320>]}
[0m14:29:28.591226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111199a90>]}
[0m14:29:28.591523 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:29:28.591693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b6ce00>]}
[0m14:29:28.592477 [info ] [MainThread]: 
[0m14:29:28.592764 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:29:28.593173 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:29:28.617083 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:29:28.617353 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:29:28.617515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:28.637674 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.020 seconds
[0m14:29:28.638624 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:29:28.640860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:29:28.644145 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:29:28.644372 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:29:28.644507 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:29:28.649214 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m14:29:28.649409 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:29:28.649556 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:29:28.656560 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:29:28.657228 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:29:28.657501 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:29:28.659975 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.660140 [debug] [MainThread]: On master: BEGIN
[0m14:29:28.660259 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:29:28.663881 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:29:28.664023 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.664206 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:29:28.670713 [debug] [MainThread]: SQL status: SELECT 4 in 0.006 seconds
[0m14:29:28.671320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111653950>]}
[0m14:29:28.671525 [debug] [MainThread]: On master: ROLLBACK
[0m14:29:28.671794 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.671918 [debug] [MainThread]: On master: BEGIN
[0m14:29:28.672392 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:29:28.672524 [debug] [MainThread]: On master: COMMIT
[0m14:29:28.672639 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.672749 [debug] [MainThread]: On master: COMMIT
[0m14:29:28.672992 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:29:28.673113 [debug] [MainThread]: On master: Close
[0m14:29:28.673304 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:29:28.673448 [info ] [MainThread]: 
[0m14:29:28.674471 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:29:28.674719 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:29:28.674922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:29:28.675088 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:29:28.679826 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:29:28.680312 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:29:28.699331 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:29:28.699870 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:29:28.700046 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:29:28.700190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:29:28.706324 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m14:29:28.706508 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:29:28.706847 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

source2 as (

    select * from "brightwheel"."brightwheel_exam"."source2"

),

source3 as (

    select * from "brightwheel"."brightwheel_exam"."source3"

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as ages_served,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as aged_served,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        concat(concat(min_age, ''), max_age) as ages_served,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        aged_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:29:28.711910 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "min_age" does not exist
LINE 150:         concat(concat(min_age, ''), max_age) as ages_served,
                                ^
DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
HINT:  Try using a table-qualified name.

[0m14:29:28.712063 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:29:28.712371 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:29:28.714502 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "min_age" does not exist
  LINE 150:         concat(concat(min_age, ''), max_age) as ages_served,
                                  ^
  DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
  HINT:  Try using a table-qualified name.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:29:28.715242 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac5e047f-701c-4168-b508-b34f4ae70945', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078bdaf0>]}
[0m14:29:28.715544 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:29:28.715838 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:29:28.716680 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.716821 [debug] [MainThread]: On master: BEGIN
[0m14:29:28.716936 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:29:28.721443 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:29:28.721598 [debug] [MainThread]: On master: COMMIT
[0m14:29:28.721723 [debug] [MainThread]: Using postgres connection "master"
[0m14:29:28.721840 [debug] [MainThread]: On master: COMMIT
[0m14:29:28.722062 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:29:28.722207 [debug] [MainThread]: On master: Close
[0m14:29:28.722395 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:29:28.722517 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:29:28.722652 [info ] [MainThread]: 
[0m14:29:28.722794 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:29:28.723108 [debug] [MainThread]: Command end result
[0m14:29:28.737269 [info ] [MainThread]: 
[0m14:29:28.737536 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:29:28.737681 [info ] [MainThread]: 
[0m14:29:28.737879 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "min_age" does not exist
  LINE 150:         concat(concat(min_age, ''), max_age) as ages_served,
                                  ^
  DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
  HINT:  Try using a table-qualified name.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:29:28.738021 [info ] [MainThread]: 
[0m14:29:28.738164 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:29:28.739102 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5108843, "process_user_time": 0.95467, "process_kernel_time": 0.108631, "process_mem_max_rss": "123191296", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:29:28.739430 [debug] [MainThread]: Command `dbt run` failed at 14:29:28.739386 after 0.51 seconds
[0m14:29:28.739633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ba6c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114f7e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6bf80>]}
[0m14:29:28.739800 [debug] [MainThread]: Flushing usage events
[0m14:30:56.803791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a35850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd2e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d1e240>]}


============================== 14:30:56.806110 | 313bd623-1ef0-41ff-a298-8f239600a4ae ==============================
[0m14:30:56.806110 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:30:56.806415 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run -m leads', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:30:56.899118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070575f0>]}
[0m14:30:56.921798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d1dbe0>]}
[0m14:30:56.922198 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:30:56.932532 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:30:56.988676 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:30:56.989041 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:30:57.087093 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:30:57.092710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a025a0>]}
[0m14:30:57.137137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a02210>]}
[0m14:30:57.137430 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:30:57.137596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd16d0>]}
[0m14:30:57.138389 [info ] [MainThread]: 
[0m14:30:57.138674 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:30:57.139092 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:30:57.164593 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:30:57.164856 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:30:57.164995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:57.176562 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m14:30:57.177496 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:30:57.179734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:30:57.182831 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:30:57.183028 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:30:57.183165 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:57.189248 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m14:30:57.189436 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:30:57.189580 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:30:57.196443 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:30:57.197395 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:30:57.197760 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:30:57.200714 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.200915 [debug] [MainThread]: On master: BEGIN
[0m14:30:57.201051 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:30:57.206168 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:30:57.206338 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.206511 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:30:57.215417 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:30:57.216065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e53500>]}
[0m14:30:57.216270 [debug] [MainThread]: On master: ROLLBACK
[0m14:30:57.216533 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.216647 [debug] [MainThread]: On master: BEGIN
[0m14:30:57.217046 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:30:57.217169 [debug] [MainThread]: On master: COMMIT
[0m14:30:57.217277 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.217388 [debug] [MainThread]: On master: COMMIT
[0m14:30:57.217586 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:30:57.217699 [debug] [MainThread]: On master: Close
[0m14:30:57.217937 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:30:57.218093 [info ] [MainThread]: 
[0m14:30:57.219324 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:30:57.219576 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:30:57.219780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:30:57.219950 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:30:57.224693 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:30:57.225250 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:30:57.244650 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:30:57.245195 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:30:57.245356 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:30:57.245500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:30:57.249413 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:30:57.249569 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:30:57.249897 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

source2 as (

    select * from "brightwheel"."brightwheel_exam"."source2"

),

source3 as (

    select * from "brightwheel"."brightwheel_exam"."source3"

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        concat(concat(min_age,' '), max_age) as aged_served,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        concat(concat(min_age, '-'), max_age) as ages_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type


    from combined

)

select * from final
  );
  
[0m14:30:57.252575 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "min_age" does not exist
LINE 192:         concat(concat(min_age,' '), max_age) as aged_served,
                                ^
DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
HINT:  Try using a table-qualified name.

[0m14:30:57.252732 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:30:57.252974 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:30:57.255056 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "min_age" does not exist
  LINE 192:         concat(concat(min_age,' '), max_age) as aged_served,
                                  ^
  DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
  HINT:  Try using a table-qualified name.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:30:57.255805 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '313bd623-1ef0-41ff-a298-8f239600a4ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070bd910>]}
[0m14:30:57.256106 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:30:57.256391 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:30:57.257254 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.257414 [debug] [MainThread]: On master: BEGIN
[0m14:30:57.257537 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:30:57.261144 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m14:30:57.261290 [debug] [MainThread]: On master: COMMIT
[0m14:30:57.261409 [debug] [MainThread]: Using postgres connection "master"
[0m14:30:57.261518 [debug] [MainThread]: On master: COMMIT
[0m14:30:57.261711 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:30:57.261824 [debug] [MainThread]: On master: Close
[0m14:30:57.261982 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:30:57.262090 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:30:57.262209 [info ] [MainThread]: 
[0m14:30:57.262345 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m14:30:57.262695 [debug] [MainThread]: Command end result
[0m14:30:57.276967 [info ] [MainThread]: 
[0m14:30:57.277233 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:30:57.277373 [info ] [MainThread]: 
[0m14:30:57.277551 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "min_age" does not exist
  LINE 192:         concat(concat(min_age,' '), max_age) as aged_served,
                                  ^
  DETAIL:  There are columns named "min_age", but they are in tables that cannot be referenced from this part of the query.
  HINT:  Try using a table-qualified name.
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:30:57.277686 [info ] [MainThread]: 
[0m14:30:57.277818 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:30:57.278616 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.50503683, "process_user_time": 0.946195, "process_kernel_time": 0.119082, "process_mem_max_rss": "124534784", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:30:57.278898 [debug] [MainThread]: Command `dbt run` failed at 14:30:57.278857 after 0.51 seconds
[0m14:30:57.279078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a76120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10885d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd2e10>]}
[0m14:30:57.279233 [debug] [MainThread]: Flushing usage events
[0m14:31:25.516384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e4fe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d13a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a1e000>]}


============================== 14:31:25.518538 | 7b5c7b8c-c602-4694-b7c9-e40664a0b864 ==============================
[0m14:31:25.518538 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:31:25.518857 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:31:25.612164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108554e60>]}
[0m14:31:25.634840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ccb1a0>]}
[0m14:31:25.635237 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:31:25.644684 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:31:25.700671 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:31:25.701043 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:31:25.800741 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:31:25.806412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f6a660>]}
[0m14:31:25.850862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3775c0>]}
[0m14:31:25.851156 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:31:25.851320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7fbcb0>]}
[0m14:31:25.852209 [info ] [MainThread]: 
[0m14:31:25.852511 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:31:25.852928 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:31:25.876088 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:31:25.876341 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:31:25.876486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:25.890564 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.014 seconds
[0m14:31:25.891509 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:31:25.893858 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:31:25.897169 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:31:25.897385 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:31:25.897522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:25.901420 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m14:31:25.901624 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:31:25.901777 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:31:25.906531 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.005 seconds
[0m14:31:25.907452 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:31:25.907751 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:31:25.910825 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.911045 [debug] [MainThread]: On master: BEGIN
[0m14:31:25.911182 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:31:25.919069 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:31:25.919278 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.919472 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:31:25.929417 [debug] [MainThread]: SQL status: SELECT 4 in 0.010 seconds
[0m14:31:25.930108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa4fce0>]}
[0m14:31:25.930346 [debug] [MainThread]: On master: ROLLBACK
[0m14:31:25.930627 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.930749 [debug] [MainThread]: On master: BEGIN
[0m14:31:25.931174 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:31:25.931312 [debug] [MainThread]: On master: COMMIT
[0m14:31:25.931432 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.931551 [debug] [MainThread]: On master: COMMIT
[0m14:31:25.931772 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:31:25.931900 [debug] [MainThread]: On master: Close
[0m14:31:25.932109 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:31:25.932254 [info ] [MainThread]: 
[0m14:31:25.933363 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:31:25.933619 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:31:25.933830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:31:25.933990 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:31:25.939119 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:31:25.939754 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:31:25.958861 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:31:25.959416 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:31:25.959590 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:31:25.959735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:25.964423 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:31:25.964606 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:31:25.964944 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

source2 as (

    select * from "brightwheel"."brightwheel_exam"."source2"

),

source3 as (

    select * from "brightwheel"."brightwheel_exam"."source3"

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        concat(concat(min_age, '-'), max_age) as ages_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type

    from combined

)

select * from final
  );
  
[0m14:31:25.970671 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "website_address" does not exist
LINE 249:         website_address,
                  ^

[0m14:31:25.970817 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:31:25.971147 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:31:25.973273 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "website_address" does not exist
  LINE 249:         website_address,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:31:25.974037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b5c7b8c-c602-4694-b7c9-e40664a0b864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085bd880>]}
[0m14:31:25.974339 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.04s]
[0m14:31:25.974629 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:31:25.975539 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.975709 [debug] [MainThread]: On master: BEGIN
[0m14:31:25.975837 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:31:25.982165 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:31:25.982379 [debug] [MainThread]: On master: COMMIT
[0m14:31:25.982519 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:25.982642 [debug] [MainThread]: On master: COMMIT
[0m14:31:25.982900 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:31:25.983042 [debug] [MainThread]: On master: Close
[0m14:31:25.983225 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:25.983341 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:31:25.983477 [info ] [MainThread]: 
[0m14:31:25.983624 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:31:25.983954 [debug] [MainThread]: Command end result
[0m14:31:25.998222 [info ] [MainThread]: 
[0m14:31:25.998516 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:31:25.998665 [info ] [MainThread]: 
[0m14:31:25.998859 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "website_address" does not exist
  LINE 249:         website_address,
                    ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:31:25.999001 [info ] [MainThread]: 
[0m14:31:25.999146 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:31:26.000047 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5131669, "process_user_time": 0.952402, "process_kernel_time": 0.111227, "process_mem_max_rss": "121913344", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:31:26.000461 [debug] [MainThread]: Command `dbt run` failed at 14:31:26.000398 after 0.51 seconds
[0m14:31:26.000709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bc2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10926bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a486b0>]}
[0m14:31:26.000893 [debug] [MainThread]: Flushing usage events
[0m14:32:13.550134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ccb080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10678e4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10678e1e0>]}


============================== 14:32:13.552243 | 882d3099-1223-4ffd-bdef-bfebdd1d5680 ==============================
[0m14:32:13.552243 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:32:13.552578 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run -m leads', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:32:13.644140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10686a330>]}
[0m14:32:13.666871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f720c0>]}
[0m14:32:13.667281 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:32:13.676870 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:32:13.733806 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:32:13.734179 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:32:13.832729 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:32:13.838434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f25a0>]}
[0m14:32:13.884049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071231a0>]}
[0m14:32:13.884366 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:32:13.884536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107185100>]}
[0m14:32:13.885335 [info ] [MainThread]: 
[0m14:32:13.885633 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:32:13.886091 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:32:13.911559 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:32:13.911834 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:32:13.911975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:32:13.923848 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.012 seconds
[0m14:32:13.924728 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:32:13.927072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:32:13.930321 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:32:13.930528 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:32:13.930662 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:32:13.937575 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:32:13.937778 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:32:13.937927 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:32:13.946348 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m14:32:13.947262 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:32:13.947764 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:32:13.950357 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:13.950508 [debug] [MainThread]: On master: BEGIN
[0m14:32:13.950630 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:32:13.955401 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:32:13.955543 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:13.955741 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:32:13.964733 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:32:13.965374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10726dee0>]}
[0m14:32:13.965606 [debug] [MainThread]: On master: ROLLBACK
[0m14:32:13.965919 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:13.966043 [debug] [MainThread]: On master: BEGIN
[0m14:32:13.966415 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:32:13.966550 [debug] [MainThread]: On master: COMMIT
[0m14:32:13.966664 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:13.966780 [debug] [MainThread]: On master: COMMIT
[0m14:32:13.966986 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:32:13.967109 [debug] [MainThread]: On master: Close
[0m14:32:13.967298 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:32:13.967440 [info ] [MainThread]: 
[0m14:32:13.968500 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:32:13.968755 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:32:13.968963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:32:13.969127 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:32:13.973798 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:32:13.974302 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:32:13.993457 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:32:13.994062 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:13.994232 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:32:13.994374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:32:13.998605 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m14:32:13.998771 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:13.999126 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

source2 as (

    select * from "brightwheel"."brightwheel_exam"."source2"

),

source3 as (

    select * from "brightwheel"."brightwheel_exam"."source3"

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website_address,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        concat(concat(min_age, '-'), max_age) as ages_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type

    from combined

)

select * from final
  );
  
[0m14:32:14.001191 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "website_address" does not exist
LINE 63:         website_address,
                 ^

[0m14:32:14.001336 [debug] [Thread-1 (]: On model.brightwheel.leads: ROLLBACK
[0m14:32:14.001572 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:32:14.003646 [debug] [Thread-1 (]: Database Error in model leads (models/2_mart/leads.sql)
  column "website_address" does not exist
  LINE 63:         website_address,
                   ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:32:14.004374 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '882d3099-1223-4ffd-bdef-bfebdd1d5680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d31430>]}
[0m14:32:14.004672 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model brightwheel_exam.leads ................... [[31mERROR[0m in 0.03s]
[0m14:32:14.004966 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:32:14.005853 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:14.005991 [debug] [MainThread]: On master: BEGIN
[0m14:32:14.006107 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:32:14.013557 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:32:14.013781 [debug] [MainThread]: On master: COMMIT
[0m14:32:14.013921 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:14.014110 [debug] [MainThread]: On master: COMMIT
[0m14:32:14.014540 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:32:14.014726 [debug] [MainThread]: On master: Close
[0m14:32:14.014942 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:32:14.015071 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:32:14.015216 [info ] [MainThread]: 
[0m14:32:14.015383 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.13 seconds (0.13s).
[0m14:32:14.015731 [debug] [MainThread]: Command end result
[0m14:32:14.030207 [info ] [MainThread]: 
[0m14:32:14.030492 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:32:14.030634 [info ] [MainThread]: 
[0m14:32:14.030806 [error] [MainThread]:   Database Error in model leads (models/2_mart/leads.sql)
  column "website_address" does not exist
  LINE 63:         website_address,
                   ^
  compiled Code at target/run/brightwheel/models/2_mart/leads.sql
[0m14:32:14.030942 [info ] [MainThread]: 
[0m14:32:14.031077 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:32:14.031882 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5108222, "process_user_time": 0.949315, "process_kernel_time": 0.111027, "process_mem_max_rss": "122421248", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:32:14.032167 [debug] [MainThread]: Command `dbt run` failed at 14:32:14.032126 after 0.51 seconds
[0m14:32:14.032353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102946c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106200500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10678e3f0>]}
[0m14:32:14.032512 [debug] [MainThread]: Flushing usage events
[0m14:32:36.630786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10735af30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801e480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801e1e0>]}


============================== 14:32:36.633079 | 55ae97fc-f9aa-4a70-9d3f-451a49a71b5b ==============================
[0m14:32:36.633079 [info ] [MainThread]: Running with dbt=1.8.5
[0m14:32:36.633393 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/paulfoote/.dbt', 'log_path': '/Users/paulfoote/Documents/dbt/brightwheel/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m leads', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:32:36.725282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c5520>]}
[0m14:32:36.749327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108120f50>]}
[0m14:32:36.750044 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:32:36.759667 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m14:32:36.816208 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:32:36.816622 [debug] [MainThread]: Partial parsing: updated file: brightwheel://models/2_mart/leads.sql
[0m14:32:36.915083 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.brightwheel.3_activation
- models.brightwheel.1_intermediate
[0m14:32:36.920768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a64590>]}
[0m14:32:36.966285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c99250>]}
[0m14:32:36.966600 [info ] [MainThread]: Found 7 models, 4 data tests, 4 sources, 417 macros
[0m14:32:36.966763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ede0f0>]}
[0m14:32:36.967535 [info ] [MainThread]: 
[0m14:32:36.967818 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:32:36.968228 [debug] [ThreadPool]: Acquiring new postgres connection 'list_brightwheel'
[0m14:32:36.993952 [debug] [ThreadPool]: Using postgres connection "list_brightwheel"
[0m14:32:36.994275 [debug] [ThreadPool]: On list_brightwheel: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel"} */

    select distinct nspname from pg_namespace
  
[0m14:32:36.994465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:32:37.005435 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.011 seconds
[0m14:32:37.006313 [debug] [ThreadPool]: On list_brightwheel: Close
[0m14:32:37.008444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_brightwheel, now list_brightwheel_brightwheel_exam)
[0m14:32:37.011464 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:32:37.011680 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: BEGIN
[0m14:32:37.011828 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:32:37.018731 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:32:37.018943 [debug] [ThreadPool]: Using postgres connection "list_brightwheel_brightwheel_exam"
[0m14:32:37.019092 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "list_brightwheel_brightwheel_exam"} */
select
      'brightwheel' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'brightwheel_exam'
    union all
    select
      'brightwheel' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'brightwheel_exam'
  
[0m14:32:37.025863 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.007 seconds
[0m14:32:37.026639 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: ROLLBACK
[0m14:32:37.026935 [debug] [ThreadPool]: On list_brightwheel_brightwheel_exam: Close
[0m14:32:37.029497 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.029663 [debug] [MainThread]: On master: BEGIN
[0m14:32:37.029781 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:32:37.035014 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:32:37.035165 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.035342 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:32:37.044557 [debug] [MainThread]: SQL status: SELECT 4 in 0.009 seconds
[0m14:32:37.045213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080fd8b0>]}
[0m14:32:37.045428 [debug] [MainThread]: On master: ROLLBACK
[0m14:32:37.045671 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.045791 [debug] [MainThread]: On master: BEGIN
[0m14:32:37.046152 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:32:37.046280 [debug] [MainThread]: On master: COMMIT
[0m14:32:37.046390 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.046497 [debug] [MainThread]: On master: COMMIT
[0m14:32:37.046694 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:32:37.046812 [debug] [MainThread]: On master: Close
[0m14:32:37.046997 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:32:37.047137 [info ] [MainThread]: 
[0m14:32:37.048119 [debug] [Thread-1 (]: Began running node model.brightwheel.leads
[0m14:32:37.048363 [info ] [Thread-1 (]: 1 of 1 START sql table model brightwheel_exam.leads ............................ [RUN]
[0m14:32:37.048567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_brightwheel_brightwheel_exam, now model.brightwheel.leads)
[0m14:32:37.048725 [debug] [Thread-1 (]: Began compiling node model.brightwheel.leads
[0m14:32:37.053228 [debug] [Thread-1 (]: Writing injected SQL for node "model.brightwheel.leads"
[0m14:32:37.053716 [debug] [Thread-1 (]: Began executing node model.brightwheel.leads
[0m14:32:37.073360 [debug] [Thread-1 (]: Writing runtime sql for node "model.brightwheel.leads"
[0m14:32:37.073915 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:37.074081 [debug] [Thread-1 (]: On model.brightwheel.leads: BEGIN
[0m14:32:37.074224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:32:37.079701 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m14:32:37.079886 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:37.080222 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */

  
    

  create  table "brightwheel"."brightwheel_exam"."leads__dbt_tmp"
  
  
    as
  
  (
    with salesforce_leads as (

    select * from "brightwheel"."brightwheel_exam"."salesforce_leads" 

),

source1 as (

    select * from "brightwheel"."brightwheel_exam"."source1"

),

source2 as (

    select * from "brightwheel"."brightwheel_exam"."source2"

),

source3 as (

    select * from "brightwheel"."brightwheel_exam"."source3"

),

combined as (
    select
        'salesforce' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        street as address1,
        null as address2,
        company,
        phone,
        mobile_phone as phone2,
        null as county,
        email,
        first_name,
        last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        null as license_type,
        null as licensee_name,
        brightwheel_school_uuid as provider_id,
        null as schedule,
        state,
        title,
        website as website_address,
        postal_code as zip,
        null as facility_type
        
    from salesforce_leads

    union all

    select
        'source1' as lead_type,
        null as accepts_financial_aid,
        null as max_age,
        null as min_age,
        null as capacity,
        expiration_date as certificate_expiration_date,
        null as city,
        address as address1,
        null as address2,
        name as company,
        phone,
        null as phone2,
        county,
        null as email,
        split_part(primary_contact_name, ' ', 1) as first_name,
        split_part(primary_contact_name, ' ', 2) as last_name,
        status as license_status,
        first_issue_date as license_issued,
        credential_number as license_number,
        credential_type as license_type,
        primary_contact_name as licensee_name,
        null as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        null as zip,
        null as facility_type

    from source1

    union all

    select
        'source2' as lead_type,
        accepts_subsidy as accepts_financial_aid,
        case
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
        end as max_age,
        case
            when ages_accepted_1 = 'Infants (0-11 months)' or
                ages_accepted_2 = 'Infants (0-11 months)' 
                then 'Infant'
            when ages_accepted_4 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_3 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_2 = 'Toddlers (12-23 months; 1yr.)' or
                ages_accepted_1 = 'Toddlers (12-23 months; 1yr.)'
            then 'Toddler'
            when ages_accepted_4 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_3 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_2 = 'Preschool (24-48 months; 2-4 yrs.)' or
                ages_accepted_1 = 'Preschool (24-48 months; 2-4 yrs.)'
            then 'Preschool'
            when ages_accepted_4 = 'School-age (5 years-older)' or
                ages_accepted_3 = 'School-age (5 years-older)' or
                ages_accepted_2 = 'School-age (5 years-older)' or
                ages_accepted_1 = 'School-age (5 years-older)'
            then 'School'
        end as min_age,
        null as capacity,
        null as certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        null as phone2,
        null as county,
        email,
        split_part(primary_caregiver, ' ', 1) as first_name,
        split_part(primary_caregiver, ' ', 2) as last_name,
        null as license_status,
        null as license_issued,
        null as license_number,
        type_license as license_type,
        primary_caregiver as licensee_name,
        null as provider_id,
        year_round as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        null as facility_type

    from source2

    union all

    select
        'source3' as lead_type,
        null as accepts_financial_aid,
        case
            when school = 'Y' then 'School'
            when preschool = 'Y' then 'Preschool'
            when toddler = 'Y' then 'Toddler'
            when infant = 'Y' then 'Infant'
        else null end as max_age,
        case
            when infant = 'Y' then 'Infant'
            when toddler = 'Y' then 'Toddler'
            when preschool = 'Y' then 'Preschool'
            when school = 'Y' then 'School'
        end as min_age,
        capacity,
        null as certificate_expiration_date,
        city,
        address as address1,
        null as address2,
        operation_name as company,
        phone,
        null as phone2,
        county,
        email_address as email,
        null as first_name,
        null as last_name,
        status as license_status,
        issue_date as license_issued,
        facility_id as license_number,
        type as license_type,
        null as licensee_name,
        facility_id as provider_id,
        null as schedule,
        state,
        null as title,
        null as website_address,
        zip,
        type as facility_type

    from source3

),

final as (
    select
        lead_type,
        accepts_financial_aid,
        concat(concat(min_age, '-'), max_age) as ages_served,
        capacity,
        certificate_expiration_date,
        city,
        address1,
        address2,
        company,
        phone,
        phone2,
        county,
        email,
        first_name,
        last_name,
        license_status,
        license_issued,
        license_number,
        license_type,
        licensee_name,
        max_age,
        min_age,
        provider_id,
        schedule,
        state,
        title,
        website_address,
        zip,
        facility_type

    from combined

)

select * from final
  );
  
[0m14:32:37.096315 [debug] [Thread-1 (]: SQL status: SELECT 166 in 0.016 seconds
[0m14:32:37.099531 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:37.099723 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */
alter table "brightwheel"."brightwheel_exam"."leads__dbt_tmp" rename to "leads"
[0m14:32:37.100464 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:32:37.109694 [debug] [Thread-1 (]: On model.brightwheel.leads: COMMIT
[0m14:32:37.109909 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:37.110072 [debug] [Thread-1 (]: On model.brightwheel.leads: COMMIT
[0m14:32:37.111190 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m14:32:37.114133 [debug] [Thread-1 (]: Applying DROP to: "brightwheel"."brightwheel_exam"."leads__dbt_backup"
[0m14:32:37.116513 [debug] [Thread-1 (]: Using postgres connection "model.brightwheel.leads"
[0m14:32:37.116690 [debug] [Thread-1 (]: On model.brightwheel.leads: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "brightwheel", "target_name": "dev", "node_id": "model.brightwheel.leads"} */
drop table if exists "brightwheel"."brightwheel_exam"."leads__dbt_backup" cascade
[0m14:32:37.117151 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m14:32:37.118239 [debug] [Thread-1 (]: On model.brightwheel.leads: Close
[0m14:32:37.118913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55ae97fc-f9aa-4a70-9d3f-451a49a71b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062dd6a0>]}
[0m14:32:37.119216 [info ] [Thread-1 (]: 1 of 1 OK created sql table model brightwheel_exam.leads ....................... [[32mSELECT 166[0m in 0.07s]
[0m14:32:37.119511 [debug] [Thread-1 (]: Finished running node model.brightwheel.leads
[0m14:32:37.120091 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.120234 [debug] [MainThread]: On master: BEGIN
[0m14:32:37.120354 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:32:37.125583 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m14:32:37.125729 [debug] [MainThread]: On master: COMMIT
[0m14:32:37.125858 [debug] [MainThread]: Using postgres connection "master"
[0m14:32:37.125973 [debug] [MainThread]: On master: COMMIT
[0m14:32:37.126190 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:32:37.126312 [debug] [MainThread]: On master: Close
[0m14:32:37.126477 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:32:37.126588 [debug] [MainThread]: Connection 'model.brightwheel.leads' was properly closed.
[0m14:32:37.126718 [info ] [MainThread]: 
[0m14:32:37.126895 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m14:32:37.127248 [debug] [MainThread]: Command end result
[0m14:32:37.141535 [info ] [MainThread]: 
[0m14:32:37.141834 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:32:37.141986 [info ] [MainThread]: 
[0m14:32:37.142142 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:32:37.142992 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5411042, "process_user_time": 0.969774, "process_kernel_time": 0.112546, "process_mem_max_rss": "124026880", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:32:37.143279 [debug] [MainThread]: Command `dbt run` succeeded at 14:32:37.143237 after 0.54 seconds
[0m14:32:37.143470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107944860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e5f740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801e480>]}
[0m14:32:37.143626 [debug] [MainThread]: Flushing usage events
